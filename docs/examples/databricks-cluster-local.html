<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-(Local Development)">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>sparklyr – Option 2 - Working inside of Databricks</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <script src="../site_libs/quarto-html/quarto-html.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/bootstrap/bootstrap-dark.min.css">
  
  <script type="text/javascript">

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-20375833-3', 'auto');

  ga('send', {
    hitType: 'pageview',
    'anonymizeIp': true,
  });
  </script>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="navbar navbar-expand-lg navbar-light bg-light ">
    <div class="container-fluid">
  <a class="navbar-brand" href="../index.html">
    sparklyr
  </a>
      <div>
        <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;"><i class="bi"></i></a>
      </div>
      <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
  </div> <!-- /container-fluid -->
</nav>
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">Option 2 - Working inside of Databricks</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto py-2 docked  overflow-scroll">
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-3 px-3">
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#usingsparklyr-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Using sparklyr</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="usingsparklyr-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../guides/connections.html" class="">Configuring connections</a>
</li>
          <li class="sidebar-item">
  <a href="../troubleshooting.html" class="">Troubleshooting</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#guides-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Guides</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="guides-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../dplyr.html" class="">Manipulating data</a>
</li>
          <li class="sidebar-item">
  <a href="../mlib.html" class="">Machine Learning</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/caching.html" class="">Understanding Caching</a>
</li>
          <li class="sidebar-item">
  <a href="../deployment.html" class="">Deployment Options</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/distributed-r.html" class="">Distributed R</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/data-lakes.html" class="">Data Lakes</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/pipelines.html" class="">ML Pipelines</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/textmining.html" class="">Text mining</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/streaming.html" class="">Stream Analysis</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/arrow.html" class="">Apache Arrow</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/aws-s3.html" class="">AWS S3 buckets</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#extendsparklyr-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Extend sparklyr</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="extendsparklyr-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../guides/h2o.html" class="">Using H2O</a>
</li>
          <li class="sidebar-item">
  <a href="../graphframes.html" class="">Graph Analysis</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/mleap.html" class="">Production pipelines</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#deploymentexamples-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Deployment Examples</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="deploymentexamples-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../examples/stand-alone-aws.html" class="">Standalone cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/yarn-cluster-emr.html" class="">YARN cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/cloudera-aws.html" class="">Cloudera cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/databricks-cluster-local.html" class="active">Databricks cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/qubole-overview.html" class="">Qubole cluster</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
<li><a href="#advantages-and-limitations" class="nav-link" data-scroll-target="#advantages-and-limitations">Advantages and limitations</a></li>
<li><a href="#requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
<li><a href="#preparation" class="nav-link" data-scroll-target="#preparation">Preparation</a></li>
<li><a href="#configure-ssh-access-to-the-spark-driver-node" class="nav-link" data-scroll-target="#configure-ssh-access-to-the-spark-driver-node">Configure SSH access to the Spark driver node</a></li>
<li><a href="#connect-to-the-spark-driver-node-via-ssh" class="nav-link" data-scroll-target="#connect-to-the-spark-driver-node-via-ssh">Connect to the Spark driver node via SSH</a></li>
<li><a href="#install-rstudio-workbench-on-the-spark-driver-node" class="nav-link" data-scroll-target="#install-rstudio-workbench-on-the-spark-driver-node">Install RStudio Workbench on the Spark driver node</a></li>
<li><a href="#configure-rstudio-workbench" class="nav-link" data-scroll-target="#configure-rstudio-workbench">Configure RStudio Workbench</a></li>
<li><a href="#access-rstudio-workbench" class="nav-link" data-scroll-target="#access-rstudio-workbench">Access RStudio Workbench</a></li>
<li><a href="#configure-sparklyr" class="nav-link" data-scroll-target="#configure-sparklyr">Configure <code>sparklyr</code></a></li>
<li><a href="#additional-information" class="nav-link" data-scroll-target="#additional-information">Additional information</a></li>
</ul>
</nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-0">
<main>
<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7">Option 2 - Working inside of Databricks</h1>
</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>If the recommended path of connecting to Spark remotely with Databricks Connect does not apply to your use case, then you can install RStudio Workbench directly within a Databricks cluster as described in the sections below.</p>
<p>With this configuration, RStudio Workbench is installed on the Spark driver node and allows users to work locally with Spark using <code>sparklyr</code>.</p>
<p><img src="../images/deployment/databricks/rstudio-databricks-local.png" width="800px" align="center"></p>
<p>This configuration can result in increased complexity, limited connectivity to other storage and compute resources, resource contention between RStudio Workbench and Databricks, and maintenance concerns due to the ephemeral nature of Databricks clusters.</p>
<p>For additional details, refer to the <a href="https://docs.databricks.com/spark/latest/sparkr/rstudio.html#frequently-asked-questions-faq">FAQ for RStudio in the Databricks Documentation</a>.</p>
</section>
<section id="advantages-and-limitations" class="level2">
<h2 class="anchored" data-anchor-id="advantages-and-limitations">Advantages and limitations</h2>
<p>Advantages:</p>
<ul>
<li>Ability for users to connect <code>sparklyr</code> to Spark without configuring remote connectivity</li>
<li>Provides a high-bandwidth connection between R and the Spark JVM processes because they are running on the same machine</li>
<li>Can load data from the cluster directly into an R session since RStudio Workbench is installed within the Databricks cluster</li>
</ul>
<p>Limitations:</p>
<ul>
<li>If the Databricks cluster is restarted or terminated, then the instance of RStudio Workbench will be terminated and its configuration will be lost</li>
<li>If users do not persist their code through version control or the Databricks File System, then you risk losing user’s work if the cluster is restarted or terminated</li>
<li>RStudio Workbench (and other RStudio products) installed within a Databricks cluster will be limited to the compute resources and lifecycle of that particular Spark cluster</li>
<li>Non-Spark jobs will use CPU and RAM resources within the Databricks cluster</li>
<li>Need to install one instance of RStudio Workbench per Spark cluster that you want to run jobs on</li>
</ul>
</section>
<section id="requirements" class="level2">
<h2 class="anchored" data-anchor-id="requirements">Requirements</h2>
<ul>
<li>A running Databricks cluster with a runtime version 4.1 or above</li>
<li>The cluster must not have “table access control” or “automatic termination” enabled</li>
<li>You must have “Can Attach To” permission for the Databricks cluster</li>
</ul>
</section>
<section id="preparation" class="level2">
<h2 class="anchored" data-anchor-id="preparation">Preparation</h2>
<p>The following steps walk through the process to install RStudio Workbench on the Spark driver node within your Databricks cluster.</p>
<p>The recommended method for installing RStudio Workbench to the Spark driver node is via SSH. However, an alternative method is available if you are not able to access the Spark driver node via SSH.</p>
</section>
<section id="configure-ssh-access-to-the-spark-driver-node" class="level2">
<h2 class="anchored" data-anchor-id="configure-ssh-access-to-the-spark-driver-node">Configure SSH access to the Spark driver node</h2>
<p>Configure SSH access to the Spark driver node in Databricks by following the steps in the <a href="https://docs.databricks.com/clusters/configure.html#ssh-access-to-clusters">SSH access to clusters section of the Databricks Cluster configurations documentation</a>.</p>
<p><strong>Note:</strong> If you are unable to configure SSH access or connect to the Spark driver node via SSH, then you can follow the steps in the <a href="https://docs.databricks.com/spark/latest/sparkr/rstudio.html#get-started-with-rstudio-server-pro">Get started with RStudio Workbench section of the RStudio on Databricks documentation</a> to install RStudio Workbench from a Databricks notebook, then skip to the <a href="#access-rstudio-server-pro">access RStudio Workbench</a> section of this documentation.</p>
</section>
<section id="connect-to-the-spark-driver-node-via-ssh" class="level2">
<h2 class="anchored" data-anchor-id="connect-to-the-spark-driver-node-via-ssh">Connect to the Spark driver node via SSH</h2>
<p>Connect to the Spark driver node via SSH on port 2200 by using the following command on your local machine:</p>
<pre><code>ssh ubuntu@&lt;spark-driver-node-address&gt; -p 2200 -i &lt;path-to-private-SSH-key&gt;</code></pre>
<p>Replace <code>&lt;spark-driver-node-address&gt;</code> with the DNS name or IP address of the Spark driver node, and <code>&lt;path-to-private-SSH-key&gt;</code> with the path to your private SSH key on your local machine.</p>
</section>
<section id="install-rstudio-workbench-on-the-spark-driver-node" class="level2">
<h2 class="anchored" data-anchor-id="install-rstudio-workbench-on-the-spark-driver-node">Install RStudio Workbench on the Spark driver node</h2>
<p>After you SSH into the Spark driver node, then you can follow the typical steps to <a href="https://docs.rstudio.com/rsp/installation/">install RStudio Workbench in the RStudio documentation</a>. In the installation steps, you can select Ubuntu as the target Linux distribution.</p>
</section>
<section id="configure-rstudio-workbench" class="level2">
<h2 class="anchored" data-anchor-id="configure-rstudio-workbench">Configure RStudio Workbench</h2>
<p>The following configuration steps are required to be able to use RStudio Workbench with Databricks.</p>
<p>Add the following configuration lines to <code>/etc/rstudio/rserver.conf</code> to use proxied authentication with Databricks and enable the administrator dashboard:</p>
<pre><code>auth-proxy=1
auth-proxy-user-header-rewrite=^(.*)$ $1
auth-proxy-sign-in-url=&lt;domain&gt;/login.html
admin-enabled=1</code></pre>
<p>Add the following configuration line to <code>/etc/rstudio/rsession-profile</code> to set the <code>PATH</code> to be used with RStudio Workbench:</p>
<pre><code>export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:$PATH</code></pre>
<p>Add the following configuration lines to <code>/etc/rstudio/rsession.conf</code> to configure sessions in RStudio Workbench to work with Databricks:</p>
<pre><code>session-rprofile-on-resume-default=1
allow-terminal-websockets=0</code></pre>
<p>Restart RStudio Workbench:</p>
<pre><code>sudo rstudio-server restart</code></pre>
</section>
<section id="access-rstudio-workbench" class="level2">
<h2 class="anchored" data-anchor-id="access-rstudio-workbench">Access RStudio Workbench</h2>
<p>From the Databricks console, click on the Databricks cluster that you want to work with:</p>
<p><img src="../images/deployment/databricks/rstudio-databricks-local-1.png" width="800px" align="center"></p>
<p>From within the Databricks cluster, click on the <code>Apps</code> tab:</p>
<p><img src="../images/deployment/databricks/rstudio-databricks-local-2.png" width="800px" align="center"></p>
<p>Click on the <code>Set up RStudio</code> button:</p>
<p><img src="../images/deployment/databricks/rstudio-databricks-local-3.png" width="800px" align="center"></p>
<p>To access RStudio Workbench, click on the link to <code>Open RStudio</code>:</p>
<p><img src="../images/deployment/databricks/rstudio-databricks-local-4.png" width="800px" align="center"></p>
<p>If you configured proxied authentication in RStudio Workbench as described in the previous section, then you do not need to use the username or password that is displayed. Instead, RStudio Workbench will automatically login and start a new RStudio session as your logged-in Databricks user:</p>
<p><img src="../images/deployment/databricks/rstudio-databricks-local-5.png" width="800px" align="center"></p>
<p>Other users can access RStudio Workbench from the Databricks console by following the same steps described above. You do not need to create those users in RStudio Workbench or their home directory beforehand.</p>
</section>
<section id="configure-sparklyr" class="level2">
<h2 class="anchored" data-anchor-id="configure-sparklyr">Configure <code>sparklyr</code></h2>
<p>Use the following R code to establish a connection from <code>sparklyr</code> to the Databricks cluster:</p>
<pre><code>SparkR::sparkR.session()
library(sparklyr)
sc &lt;- spark_connect(method = "databricks")</code></pre>
</section>
<section id="additional-information" class="level2">
<h2 class="anchored" data-anchor-id="additional-information">Additional information</h2>
<p>For more information on using RStudio Workbench inside of Databricks, refer to the sections on <a href="https://docs.databricks.com/spark/latest/sparkr/rstudio.html">RStudio on Databricks (AWS)</a> or <a href="https://docs.microsoft.com/en-us/azure/databricks/spark/latest/sparkr/rstudio">RStudio on Databricks (Azure)</a> in the Databricks documentation.</p>
<!-- -->
</section>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->


</body></html>