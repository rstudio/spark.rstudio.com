{
  "hash": "377ffcc0b14924cdaaa4a82616935e02",
  "result": {
    "markdown": "---\ntitle: \"Model Tuning - Part II\"\nexecute:\n  eval: true\n  freeze: true\n---\n\n\n\n\n## Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sparklyr)\n\nsc <- spark_connect(master = \"local\", version = \"3.3\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(modeldata)\n\ndata(\"small_fine_foods\")\n\nsff_training_data <- copy_to(sc, training_data)\n\nsff_testing_data <- copy_to(sc, testing_data)\n```\n:::\n\n\n## Pipeline\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsff_pipeline <- ml_pipeline(sc) %>% \n  ft_tokenizer(\n    input_col = \"review\",\n    output_col = \"word_list\"\n  ) %>% \n  ft_stop_words_remover(\n    input_col = \"word_list\", \n    output_col = \"wo_stop_words\"\n    ) %>% \n  ft_hashing_tf(\n    input_col = \"wo_stop_words\", \n    output_col = \"hashed_features\", \n    binary = TRUE, \n    num_features = 1024\n    ) %>%\n  ft_normalizer(\n    input_col = \"hashed_features\", \n    output_col = \"normal_features\"\n    ) %>% \n  ft_r_formula(score ~ normal_features) %>% \n  ml_logistic_regression()\n```\n:::\n\n\n## Grid\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsff_grid <-  list(\n    hashing_tf = list(\n      num_features = 2^c(8, 10, 12)  \n    ),\n    logistic_regression = list(\n      elastic_net_param = 10^seq(-3, 0, length = 20), # penalty\n      reg_param = seq(0, 1, length = 5) # mixture      \n    )\n  )\n\nsff_grid\n#> $hashing_tf\n#> $hashing_tf$num_features\n#> [1]  256 1024 4096\n#> \n#> \n#> $logistic_regression\n#> $logistic_regression$elastic_net_param\n#>  [1] 0.001000000 0.001438450 0.002069138 0.002976351 0.004281332 0.006158482\n#>  [7] 0.008858668 0.012742750 0.018329807 0.026366509 0.037926902 0.054555948\n#> [13] 0.078475997 0.112883789 0.162377674 0.233572147 0.335981829 0.483293024\n#> [19] 0.695192796 1.000000000\n#> \n#> $logistic_regression$reg_param\n#> [1] 0.00 0.25 0.50 0.75 1.00\n```\n:::\n\n\n## Evaluator\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsff_evaluator <- ml_binary_classification_evaluator(x = sc)\n```\n:::\n\n\n## Model Tuning\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsff_cv <- ml_cross_validator(\n  x = sc,\n  estimator = sff_pipeline, \n  estimator_param_maps = sff_grid,\n  evaluator = sff_evaluator,\n  num_folds = 3,\n  parallelism = 4\n)\n\nsff_cv\n#> CrossValidator (Estimator)\n#> <cross_validator__51c917ed_d4a7_4aa3_a6c5_f957dd646351> \n#>  (Parameters -- Tuning)\n#>   estimator: Pipeline\n#>              <pipeline__c2b90ff0_ccc1_4a1b_ad99_bfb216cad0aa> \n#>   evaluator: BinaryClassificationEvaluator\n#>              <binary_classification_evaluator__ccb244c2_c404_4584_9707_3d82e7625d84> \n#>     with metric areaUnderROC \n#>   num_folds: 3 \n#>   [Tuned over 300 hyperparameter sets]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsff_model <- ml_fit(\n  x = sff_cv, \n  dataset = sff_training_data\n  )\n```\n:::\n\n\n## Validation metrics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsff_metrics <- ml_validation_metrics(sff_model)\n\nsff_metrics\n#>     areaUnderROC reg_param_1 elastic_net_param_1 num_features_2\n#> 1      0.6872100        0.00         0.001000000            256\n#> 2      0.6469788        0.00         0.001000000           1024\n#> 3      0.6847603        0.00         0.001000000           4096\n#> 4      0.6872100        0.00         0.001438450            256\n#> 5      0.6469788        0.00         0.001438450           1024\n#> 6      0.6847603        0.00         0.001438450           4096\n#> 7      0.6872100        0.00         0.002069138            256\n#> 8      0.6469788        0.00         0.002069138           1024\n#> 9      0.6847603        0.00         0.002069138           4096\n#> 10     0.6872100        0.00         0.002976351            256\n#> 11     0.6469788        0.00         0.002976351           1024\n#> 12     0.6847603        0.00         0.002976351           4096\n#> 13     0.6872100        0.00         0.004281332            256\n#> 14     0.6469788        0.00         0.004281332           1024\n#> 15     0.6847603        0.00         0.004281332           4096\n#> 16     0.6872100        0.00         0.006158482            256\n#> 17     0.6469788        0.00         0.006158482           1024\n#> 18     0.6847603        0.00         0.006158482           4096\n#> 19     0.6872100        0.00         0.008858668            256\n#> 20     0.6469788        0.00         0.008858668           1024\n#> 21     0.6847603        0.00         0.008858668           4096\n#> 22     0.6872100        0.00         0.012742750            256\n#> 23     0.6469788        0.00         0.012742750           1024\n#> 24     0.6847603        0.00         0.012742750           4096\n#> 25     0.6872100        0.00         0.018329807            256\n#> 26     0.6469788        0.00         0.018329807           1024\n#> 27     0.6847603        0.00         0.018329807           4096\n#> 28     0.6872100        0.00         0.026366509            256\n#> 29     0.6469788        0.00         0.026366509           1024\n#> 30     0.6847603        0.00         0.026366509           4096\n#> 31     0.6872100        0.00         0.037926902            256\n#> 32     0.6469788        0.00         0.037926902           1024\n#> 33     0.6847603        0.00         0.037926902           4096\n#> 34     0.6872100        0.00         0.054555948            256\n#> 35     0.6469788        0.00         0.054555948           1024\n#> 36     0.6847603        0.00         0.054555948           4096\n#> 37     0.6872100        0.00         0.078475997            256\n#> 38     0.6469788        0.00         0.078475997           1024\n#> 39     0.6847603        0.00         0.078475997           4096\n#> 40     0.6872100        0.00         0.112883789            256\n#> 41     0.6469788        0.00         0.112883789           1024\n#> 42     0.6847603        0.00         0.112883789           4096\n#> 43     0.6872100        0.00         0.162377674            256\n#> 44     0.6469788        0.00         0.162377674           1024\n#> 45     0.6847603        0.00         0.162377674           4096\n#> 46     0.6872100        0.00         0.233572147            256\n#> 47     0.6469788        0.00         0.233572147           1024\n#> 48     0.6847603        0.00         0.233572147           4096\n#> 49     0.6872100        0.00         0.335981829            256\n#> 50     0.6469788        0.00         0.335981829           1024\n#> 51     0.6847603        0.00         0.335981829           4096\n#> 52     0.6872100        0.00         0.483293024            256\n#> 53     0.6469788        0.00         0.483293024           1024\n#> 54     0.6847603        0.00         0.483293024           4096\n#> 55     0.6872100        0.00         0.695192796            256\n#> 56     0.6469788        0.00         0.695192796           1024\n#> 57     0.6847603        0.00         0.695192796           4096\n#> 58     0.6872100        0.00         1.000000000            256\n#> 59     0.6469788        0.00         1.000000000           1024\n#> 60     0.6847603        0.00         1.000000000           4096\n#> 61     0.6979099        0.25         0.001000000            256\n#> 62     0.7350719        0.25         0.001000000           1024\n#> 63     0.7310800        0.25         0.001000000           4096\n#> 64     0.6980046        0.25         0.001438450            256\n#> 65     0.7354199        0.25         0.001438450           1024\n#> 66     0.7322729        0.25         0.001438450           4096\n#> 67     0.6980958        0.25         0.002069138            256\n#> 68     0.7358291        0.25         0.002069138           1024\n#> 69     0.7339987        0.25         0.002069138           4096\n#> 70     0.6982830        0.25         0.002976351            256\n#> 71     0.7364371        0.25         0.002976351           1024\n#> 72     0.7362918        0.25         0.002976351           4096\n#> 73     0.6983929        0.25         0.004281332            256\n#> 74     0.7373639        0.25         0.004281332           1024\n#> 75     0.7394552        0.25         0.004281332           4096\n#> 76     0.6985170        0.25         0.006158482            256\n#> 77     0.7386071        0.25         0.006158482           1024\n#> 78     0.7439274        0.25         0.006158482           4096\n#> 79     0.6987447        0.25         0.008858668            256\n#> 80     0.7404082        0.25         0.008858668           1024\n#> 81     0.7494752        0.25         0.008858668           4096\n#> 82     0.6989694        0.25         0.012742750            256\n#> 83     0.7425174        0.25         0.012742750           1024\n#> 84     0.7559214        0.25         0.012742750           4096\n#> 85     0.6990192        0.25         0.018329807            256\n#> 86     0.7447573        0.25         0.018329807           1024\n#> 87     0.7631101        0.25         0.018329807           4096\n#> 88     0.6988485        0.25         0.026366509            256\n#> 89     0.7453157        0.25         0.026366509           1024\n#> 90     0.7710190        0.25         0.026366509           4096\n#> 91     0.6970921        0.25         0.037926902            256\n#> 92     0.7442522        0.25         0.037926902           1024\n#> 93     0.7755081        0.25         0.037926902           4096\n#> 94     0.6904979        0.25         0.054555948            256\n#> 95     0.7396330        0.25         0.054555948           1024\n#> 96     0.7756850        0.25         0.054555948           4096\n#> 97     0.6774064        0.25         0.078475997            256\n#> 98     0.7315540        0.25         0.078475997           1024\n#> 99     0.7692096        0.25         0.078475997           4096\n#> 100    0.6575001        0.25         0.112883789            256\n#> 101    0.7099845        0.25         0.112883789           1024\n#> 102    0.7463425        0.25         0.112883789           4096\n#> 103    0.6281753        0.25         0.162377674            256\n#> 104    0.6729857        0.25         0.162377674           1024\n#> 105    0.6940237        0.25         0.162377674           4096\n#> 106    0.5790465        0.25         0.233572147            256\n#> 107    0.6293331        0.25         0.233572147           1024\n#> 108    0.6419206        0.25         0.233572147           4096\n#> 109    0.5000000        0.25         0.335981829            256\n#> 110    0.5000000        0.25         0.335981829           1024\n#> 111    0.5000000        0.25         0.335981829           4096\n#> 112    0.5000000        0.25         0.483293024            256\n#> 113    0.5000000        0.25         0.483293024           1024\n#> 114    0.5000000        0.25         0.483293024           4096\n#> 115    0.5000000        0.25         0.695192796            256\n#> 116    0.5000000        0.25         0.695192796           1024\n#> 117    0.5000000        0.25         0.695192796           4096\n#> 118    0.5000000        0.25         1.000000000            256\n#> 119    0.5000000        0.25         1.000000000           1024\n#> 120    0.5000000        0.25         1.000000000           4096\n#> 121    0.6981182        0.50         0.001000000            256\n#> 122    0.7415227        0.50         0.001000000           1024\n#> 123    0.7414234        0.50         0.001000000           4096\n#> 124    0.6982098        0.50         0.001438450            256\n#> 125    0.7419624        0.50         0.001438450           1024\n#> 126    0.7432965        0.50         0.001438450           4096\n#> 127    0.6983498        0.50         0.002069138            256\n#> 128    0.7426982        0.50         0.002069138           1024\n#> 129    0.7458165        0.50         0.002069138           4096\n#> 130    0.6984769        0.50         0.002976351            256\n#> 131    0.7435047        0.50         0.002976351           1024\n#> 132    0.7492142        0.50         0.002976351           4096\n#> 133    0.6984470        0.50         0.004281332            256\n#> 134    0.7447591        0.50         0.004281332           1024\n#> 135    0.7537366        0.50         0.004281332           4096\n#> 136    0.6983815        0.50         0.006158482            256\n#> 137    0.7460529        0.50         0.006158482           1024\n#> 138    0.7592685        0.50         0.006158482           4096\n#> 139    0.6983820        0.50         0.008858668            256\n#> 140    0.7474411        0.50         0.008858668           1024\n#> 141    0.7656606        0.50         0.008858668           4096\n#> 142    0.6979045        0.50         0.012742750            256\n#> 143    0.7473784        0.50         0.012742750           1024\n#> 144    0.7726028        0.50         0.012742750           4096\n#> 145    0.6963427        0.50         0.018329807            256\n#> 146    0.7458104        0.50         0.018329807           1024\n#> 147    0.7775263        0.50         0.018329807           4096\n#> 148    0.6909953        0.50         0.026366509            256\n#> 149    0.7410862        0.50         0.026366509           1024\n#> 150    0.7769841        0.50         0.026366509           4096\n#> 151    0.6803165        0.50         0.037926902            256\n#> 152    0.7325500        0.50         0.037926902           1024\n#> 153    0.7704612        0.50         0.037926902           4096\n#> 154    0.6601470        0.50         0.054555948            256\n#> 155    0.7136203        0.50         0.054555948           1024\n#> 156    0.7504291        0.50         0.054555948           4096\n#> 157    0.6321536        0.50         0.078475997            256\n#> 158    0.6775525        0.50         0.078475997           1024\n#> 159    0.7014913        0.50         0.078475997           4096\n#> 160    0.5790993        0.50         0.112883789            256\n#> 161    0.6306399        0.50         0.112883789           1024\n#> 162    0.6472148        0.50         0.112883789           4096\n#> 163    0.5000000        0.50         0.162377674            256\n#> 164    0.5000000        0.50         0.162377674           1024\n#> 165    0.5000000        0.50         0.162377674           4096\n#> 166    0.5000000        0.50         0.233572147            256\n#> 167    0.5000000        0.50         0.233572147           1024\n#> 168    0.5000000        0.50         0.233572147           4096\n#> 169    0.5000000        0.50         0.335981829            256\n#> 170    0.5000000        0.50         0.335981829           1024\n#> 171    0.5000000        0.50         0.335981829           4096\n#> 172    0.5000000        0.50         0.483293024            256\n#> 173    0.5000000        0.50         0.483293024           1024\n#> 174    0.5000000        0.50         0.483293024           4096\n#> 175    0.5000000        0.50         0.695192796            256\n#> 176    0.5000000        0.50         0.695192796           1024\n#> 177    0.5000000        0.50         0.695192796           4096\n#> 178    0.5000000        0.50         1.000000000            256\n#> 179    0.5000000        0.50         1.000000000           1024\n#> 180    0.5000000        0.50         1.000000000           4096\n#> 181    0.6975126        0.75         0.001000000            256\n#> 182    0.7439557        0.75         0.001000000           1024\n#> 183    0.7469748        0.75         0.001000000           4096\n#> 184    0.6975619        0.75         0.001438450            256\n#> 185    0.7445738        0.75         0.001438450           1024\n#> 186    0.7491337        0.75         0.001438450           4096\n#> 187    0.6976136        0.75         0.002069138            256\n#> 188    0.7453605        0.75         0.002069138           1024\n#> 189    0.7520229        0.75         0.002069138           4096\n#> 190    0.6976012        0.75         0.002976351            256\n#> 191    0.7463250        0.75         0.002976351           1024\n#> 192    0.7562769        0.75         0.002976351           4096\n#> 193    0.6973388        0.75         0.004281332            256\n#> 194    0.7472638        0.75         0.004281332           1024\n#> 195    0.7612309        0.75         0.004281332           4096\n#> 196    0.6972782        0.75         0.006158482            256\n#> 197    0.7479264        0.75         0.006158482           1024\n#> 198    0.7669577        0.75         0.006158482           4096\n#> 199    0.6967465        0.75         0.008858668            256\n#> 200    0.7474146        0.75         0.008858668           1024\n#> 201    0.7730518        0.75         0.008858668           4096\n#> 202    0.6948383        0.75         0.012742750            256\n#> 203    0.7456541        0.75         0.012742750           1024\n#> 204    0.7777806        0.75         0.012742750           4096\n#> 205    0.6896845        0.75         0.018329807            256\n#> 206    0.7403040        0.75         0.018329807           1024\n#> 207    0.7766766        0.75         0.018329807           4096\n#> 208    0.6785778        0.75         0.026366509            256\n#> 209    0.7317691        0.75         0.026366509           1024\n#> 210    0.7696205        0.75         0.026366509           4096\n#> 211    0.6586098        0.75         0.037926902            256\n#> 212    0.7118787        0.75         0.037926902           1024\n#> 213    0.7480018        0.75         0.037926902           4096\n#> 214    0.6287032        0.75         0.054555948            256\n#> 215    0.6731468        0.75         0.054555948           1024\n#> 216    0.6940427        0.75         0.054555948           4096\n#> 217    0.5790259        0.75         0.078475997            256\n#> 218    0.6284772        0.75         0.078475997           1024\n#> 219    0.6416976        0.75         0.078475997           4096\n#> 220    0.5000000        0.75         0.112883789            256\n#> 221    0.5000000        0.75         0.112883789           1024\n#> 222    0.5000000        0.75         0.112883789           4096\n#> 223    0.5000000        0.75         0.162377674            256\n#> 224    0.5000000        0.75         0.162377674           1024\n#> 225    0.5000000        0.75         0.162377674           4096\n#> 226    0.5000000        0.75         0.233572147            256\n#> 227    0.5000000        0.75         0.233572147           1024\n#> 228    0.5000000        0.75         0.233572147           4096\n#> 229    0.5000000        0.75         0.335981829            256\n#> 230    0.5000000        0.75         0.335981829           1024\n#> 231    0.5000000        0.75         0.335981829           4096\n#> 232    0.5000000        0.75         0.483293024            256\n#> 233    0.5000000        0.75         0.483293024           1024\n#> 234    0.5000000        0.75         0.483293024           4096\n#> 235    0.5000000        0.75         0.695192796            256\n#> 236    0.5000000        0.75         0.695192796           1024\n#> 237    0.5000000        0.75         0.695192796           4096\n#> 238    0.5000000        0.75         1.000000000            256\n#> 239    0.5000000        0.75         1.000000000           1024\n#> 240    0.5000000        0.75         1.000000000           4096\n#> 241    0.6965971        1.00         0.001000000            256\n#> 242    0.7450036        1.00         0.001000000           1024\n#> 243    0.7502865        1.00         0.001000000           4096\n#> 244    0.6966713        1.00         0.001438450            256\n#> 245    0.7456079        1.00         0.001438450           1024\n#> 246    0.7528185        1.00         0.001438450           4096\n#> 247    0.6965578        1.00         0.002069138            256\n#> 248    0.7463634        1.00         0.002069138           1024\n#> 249    0.7562660        1.00         0.002069138           4096\n#> 250    0.6965212        1.00         0.002976351            256\n#> 251    0.7471870        1.00         0.002976351           1024\n#> 252    0.7605150        1.00         0.002976351           4096\n#> 253    0.6963988        1.00         0.004281332            256\n#> 254    0.7475712        1.00         0.004281332           1024\n#> 255    0.7659341        1.00         0.004281332           4096\n#> 256    0.6958215        1.00         0.006158482            256\n#> 257    0.7473681        1.00         0.006158482           1024\n#> 258    0.7713183        1.00         0.006158482           4096\n#> 259    0.6944135        1.00         0.008858668            256\n#> 260    0.7456643        1.00         0.008858668           1024\n#> 261    0.7766600        1.00         0.008858668           4096\n#> 262    0.6905182        1.00         0.012742750            256\n#> 263    0.7417166        1.00         0.012742750           1024\n#> 264    0.7772891        1.00         0.012742750           4096\n#> 265    0.6824843        1.00         0.018329807            256\n#> 266    0.7331884        1.00         0.018329807           1024\n#> 267    0.7718203        1.00         0.018329807           4096\n#> 268    0.6623980        1.00         0.026366509            256\n#> 269    0.7177023        1.00         0.026366509           1024\n#> 270    0.7558183        1.00         0.026366509           4096\n#> 271    0.6368928        1.00         0.037926902            256\n#> 272    0.6810042        1.00         0.037926902           1024\n#> 273    0.7137571        1.00         0.037926902           4096\n#> 274    0.5864294        1.00         0.054555948            256\n#> 275    0.6316248        1.00         0.054555948           1024\n#> 276    0.6510266        1.00         0.054555948           4096\n#> 277    0.5225389        1.00         0.078475997            256\n#> 278    0.5000000        1.00         0.078475997           1024\n#> 279    0.5000000        1.00         0.078475997           4096\n#> 280    0.5000000        1.00         0.112883789            256\n#> 281    0.5000000        1.00         0.112883789           1024\n#> 282    0.5000000        1.00         0.112883789           4096\n#> 283    0.5000000        1.00         0.162377674            256\n#> 284    0.5000000        1.00         0.162377674           1024\n#> 285    0.5000000        1.00         0.162377674           4096\n#> 286    0.5000000        1.00         0.233572147            256\n#> 287    0.5000000        1.00         0.233572147           1024\n#> 288    0.5000000        1.00         0.233572147           4096\n#> 289    0.5000000        1.00         0.335981829            256\n#> 290    0.5000000        1.00         0.335981829           1024\n#> 291    0.5000000        1.00         0.335981829           4096\n#> 292    0.5000000        1.00         0.483293024            256\n#> 293    0.5000000        1.00         0.483293024           1024\n#> 294    0.5000000        1.00         0.483293024           4096\n#> 295    0.5000000        1.00         0.695192796            256\n#> 296    0.5000000        1.00         0.695192796           1024\n#> 297    0.5000000        1.00         0.695192796           4096\n#> 298    0.5000000        1.00         1.000000000            256\n#> 299    0.5000000        1.00         1.000000000           1024\n#> 300    0.5000000        1.00         1.000000000           4096\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nsff_metrics %>% \n  mutate(reg_param_1 = as.factor(reg_param_1)) %>% \n  ggplot() +\n  geom_line(aes(elastic_net_param_1, areaUnderROC, color = reg_param_1)) +\n  facet_wrap(~ num_features_2) +\n  theme_light()\n```\n\n::: {.cell-output-display}\n![](model_tuning_text_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\nsff_metrics %>% \n  arrange(desc(areaUnderROC))\n#>     areaUnderROC reg_param_1 elastic_net_param_1 num_features_2\n#> 1      0.7777806        0.75         0.012742750           4096\n#> 2      0.7775263        0.50         0.018329807           4096\n#> 3      0.7772891        1.00         0.012742750           4096\n#> 4      0.7769841        0.50         0.026366509           4096\n#> 5      0.7766766        0.75         0.018329807           4096\n#> 6      0.7766600        1.00         0.008858668           4096\n#> 7      0.7756850        0.25         0.054555948           4096\n#> 8      0.7755081        0.25         0.037926902           4096\n#> 9      0.7730518        0.75         0.008858668           4096\n#> 10     0.7726028        0.50         0.012742750           4096\n#> 11     0.7718203        1.00         0.018329807           4096\n#> 12     0.7713183        1.00         0.006158482           4096\n#> 13     0.7710190        0.25         0.026366509           4096\n#> 14     0.7704612        0.50         0.037926902           4096\n#> 15     0.7696205        0.75         0.026366509           4096\n#> 16     0.7692096        0.25         0.078475997           4096\n#> 17     0.7669577        0.75         0.006158482           4096\n#> 18     0.7659341        1.00         0.004281332           4096\n#> 19     0.7656606        0.50         0.008858668           4096\n#> 20     0.7631101        0.25         0.018329807           4096\n#> 21     0.7612309        0.75         0.004281332           4096\n#> 22     0.7605150        1.00         0.002976351           4096\n#> 23     0.7592685        0.50         0.006158482           4096\n#> 24     0.7562769        0.75         0.002976351           4096\n#> 25     0.7562660        1.00         0.002069138           4096\n#> 26     0.7559214        0.25         0.012742750           4096\n#> 27     0.7558183        1.00         0.026366509           4096\n#> 28     0.7537366        0.50         0.004281332           4096\n#> 29     0.7528185        1.00         0.001438450           4096\n#> 30     0.7520229        0.75         0.002069138           4096\n#> 31     0.7504291        0.50         0.054555948           4096\n#> 32     0.7502865        1.00         0.001000000           4096\n#> 33     0.7494752        0.25         0.008858668           4096\n#> 34     0.7492142        0.50         0.002976351           4096\n#> 35     0.7491337        0.75         0.001438450           4096\n#> 36     0.7480018        0.75         0.037926902           4096\n#> 37     0.7479264        0.75         0.006158482           1024\n#> 38     0.7475712        1.00         0.004281332           1024\n#> 39     0.7474411        0.50         0.008858668           1024\n#> 40     0.7474146        0.75         0.008858668           1024\n#> 41     0.7473784        0.50         0.012742750           1024\n#> 42     0.7473681        1.00         0.006158482           1024\n#> 43     0.7472638        0.75         0.004281332           1024\n#> 44     0.7471870        1.00         0.002976351           1024\n#> 45     0.7469748        0.75         0.001000000           4096\n#> 46     0.7463634        1.00         0.002069138           1024\n#> 47     0.7463425        0.25         0.112883789           4096\n#> 48     0.7463250        0.75         0.002976351           1024\n#> 49     0.7460529        0.50         0.006158482           1024\n#> 50     0.7458165        0.50         0.002069138           4096\n#> 51     0.7458104        0.50         0.018329807           1024\n#> 52     0.7456643        1.00         0.008858668           1024\n#> 53     0.7456541        0.75         0.012742750           1024\n#> 54     0.7456079        1.00         0.001438450           1024\n#> 55     0.7453605        0.75         0.002069138           1024\n#> 56     0.7453157        0.25         0.026366509           1024\n#> 57     0.7450036        1.00         0.001000000           1024\n#> 58     0.7447591        0.50         0.004281332           1024\n#> 59     0.7447573        0.25         0.018329807           1024\n#> 60     0.7445738        0.75         0.001438450           1024\n#> 61     0.7442522        0.25         0.037926902           1024\n#> 62     0.7439557        0.75         0.001000000           1024\n#> 63     0.7439274        0.25         0.006158482           4096\n#> 64     0.7435047        0.50         0.002976351           1024\n#> 65     0.7432965        0.50         0.001438450           4096\n#> 66     0.7426982        0.50         0.002069138           1024\n#> 67     0.7425174        0.25         0.012742750           1024\n#> 68     0.7419624        0.50         0.001438450           1024\n#> 69     0.7417166        1.00         0.012742750           1024\n#> 70     0.7415227        0.50         0.001000000           1024\n#> 71     0.7414234        0.50         0.001000000           4096\n#> 72     0.7410862        0.50         0.026366509           1024\n#> 73     0.7404082        0.25         0.008858668           1024\n#> 74     0.7403040        0.75         0.018329807           1024\n#> 75     0.7396330        0.25         0.054555948           1024\n#> 76     0.7394552        0.25         0.004281332           4096\n#> 77     0.7386071        0.25         0.006158482           1024\n#> 78     0.7373639        0.25         0.004281332           1024\n#> 79     0.7364371        0.25         0.002976351           1024\n#> 80     0.7362918        0.25         0.002976351           4096\n#> 81     0.7358291        0.25         0.002069138           1024\n#> 82     0.7354199        0.25         0.001438450           1024\n#> 83     0.7350719        0.25         0.001000000           1024\n#> 84     0.7339987        0.25         0.002069138           4096\n#> 85     0.7331884        1.00         0.018329807           1024\n#> 86     0.7325500        0.50         0.037926902           1024\n#> 87     0.7322729        0.25         0.001438450           4096\n#> 88     0.7317691        0.75         0.026366509           1024\n#> 89     0.7315540        0.25         0.078475997           1024\n#> 90     0.7310800        0.25         0.001000000           4096\n#> 91     0.7177023        1.00         0.026366509           1024\n#> 92     0.7137571        1.00         0.037926902           4096\n#> 93     0.7136203        0.50         0.054555948           1024\n#> 94     0.7118787        0.75         0.037926902           1024\n#> 95     0.7099845        0.25         0.112883789           1024\n#> 96     0.7014913        0.50         0.078475997           4096\n#> 97     0.6990192        0.25         0.018329807            256\n#> 98     0.6989694        0.25         0.012742750            256\n#> 99     0.6988485        0.25         0.026366509            256\n#> 100    0.6987447        0.25         0.008858668            256\n#> 101    0.6985170        0.25         0.006158482            256\n#> 102    0.6984769        0.50         0.002976351            256\n#> 103    0.6984470        0.50         0.004281332            256\n#> 104    0.6983929        0.25         0.004281332            256\n#> 105    0.6983820        0.50         0.008858668            256\n#> 106    0.6983815        0.50         0.006158482            256\n#> 107    0.6983498        0.50         0.002069138            256\n#> 108    0.6982830        0.25         0.002976351            256\n#> 109    0.6982098        0.50         0.001438450            256\n#> 110    0.6981182        0.50         0.001000000            256\n#> 111    0.6980958        0.25         0.002069138            256\n#> 112    0.6980046        0.25         0.001438450            256\n#> 113    0.6979099        0.25         0.001000000            256\n#> 114    0.6979045        0.50         0.012742750            256\n#> 115    0.6976136        0.75         0.002069138            256\n#> 116    0.6976012        0.75         0.002976351            256\n#> 117    0.6975619        0.75         0.001438450            256\n#> 118    0.6975126        0.75         0.001000000            256\n#> 119    0.6973388        0.75         0.004281332            256\n#> 120    0.6972782        0.75         0.006158482            256\n#> 121    0.6970921        0.25         0.037926902            256\n#> 122    0.6967465        0.75         0.008858668            256\n#> 123    0.6966713        1.00         0.001438450            256\n#> 124    0.6965971        1.00         0.001000000            256\n#> 125    0.6965578        1.00         0.002069138            256\n#> 126    0.6965212        1.00         0.002976351            256\n#> 127    0.6963988        1.00         0.004281332            256\n#> 128    0.6963427        0.50         0.018329807            256\n#> 129    0.6958215        1.00         0.006158482            256\n#> 130    0.6948383        0.75         0.012742750            256\n#> 131    0.6944135        1.00         0.008858668            256\n#> 132    0.6940427        0.75         0.054555948           4096\n#> 133    0.6940237        0.25         0.162377674           4096\n#> 134    0.6909953        0.50         0.026366509            256\n#> 135    0.6905182        1.00         0.012742750            256\n#> 136    0.6904979        0.25         0.054555948            256\n#> 137    0.6896845        0.75         0.018329807            256\n#> 138    0.6872100        0.00         0.001000000            256\n#> 139    0.6872100        0.00         0.001438450            256\n#> 140    0.6872100        0.00         0.002069138            256\n#> 141    0.6872100        0.00         0.002976351            256\n#> 142    0.6872100        0.00         0.004281332            256\n#> 143    0.6872100        0.00         0.006158482            256\n#> 144    0.6872100        0.00         0.008858668            256\n#> 145    0.6872100        0.00         0.012742750            256\n#> 146    0.6872100        0.00         0.018329807            256\n#> 147    0.6872100        0.00         0.026366509            256\n#> 148    0.6872100        0.00         0.037926902            256\n#> 149    0.6872100        0.00         0.054555948            256\n#> 150    0.6872100        0.00         0.078475997            256\n#> 151    0.6872100        0.00         0.112883789            256\n#> 152    0.6872100        0.00         0.162377674            256\n#> 153    0.6872100        0.00         0.233572147            256\n#> 154    0.6872100        0.00         0.335981829            256\n#> 155    0.6872100        0.00         0.483293024            256\n#> 156    0.6872100        0.00         0.695192796            256\n#> 157    0.6872100        0.00         1.000000000            256\n#> 158    0.6847603        0.00         0.001000000           4096\n#> 159    0.6847603        0.00         0.001438450           4096\n#> 160    0.6847603        0.00         0.002069138           4096\n#> 161    0.6847603        0.00         0.002976351           4096\n#> 162    0.6847603        0.00         0.004281332           4096\n#> 163    0.6847603        0.00         0.006158482           4096\n#> 164    0.6847603        0.00         0.008858668           4096\n#> 165    0.6847603        0.00         0.012742750           4096\n#> 166    0.6847603        0.00         0.018329807           4096\n#> 167    0.6847603        0.00         0.026366509           4096\n#> 168    0.6847603        0.00         0.037926902           4096\n#> 169    0.6847603        0.00         0.054555948           4096\n#> 170    0.6847603        0.00         0.078475997           4096\n#> 171    0.6847603        0.00         0.112883789           4096\n#> 172    0.6847603        0.00         0.162377674           4096\n#> 173    0.6847603        0.00         0.233572147           4096\n#> 174    0.6847603        0.00         0.335981829           4096\n#> 175    0.6847603        0.00         0.483293024           4096\n#> 176    0.6847603        0.00         0.695192796           4096\n#> 177    0.6847603        0.00         1.000000000           4096\n#> 178    0.6824843        1.00         0.018329807            256\n#> 179    0.6810042        1.00         0.037926902           1024\n#> 180    0.6803165        0.50         0.037926902            256\n#> 181    0.6785778        0.75         0.026366509            256\n#> 182    0.6775525        0.50         0.078475997           1024\n#> 183    0.6774064        0.25         0.078475997            256\n#> 184    0.6731468        0.75         0.054555948           1024\n#> 185    0.6729857        0.25         0.162377674           1024\n#> 186    0.6623980        1.00         0.026366509            256\n#> 187    0.6601470        0.50         0.054555948            256\n#> 188    0.6586098        0.75         0.037926902            256\n#> 189    0.6575001        0.25         0.112883789            256\n#> 190    0.6510266        1.00         0.054555948           4096\n#> 191    0.6472148        0.50         0.112883789           4096\n#> 192    0.6469788        0.00         0.001000000           1024\n#> 193    0.6469788        0.00         0.001438450           1024\n#> 194    0.6469788        0.00         0.002069138           1024\n#> 195    0.6469788        0.00         0.002976351           1024\n#> 196    0.6469788        0.00         0.004281332           1024\n#> 197    0.6469788        0.00         0.006158482           1024\n#> 198    0.6469788        0.00         0.008858668           1024\n#> 199    0.6469788        0.00         0.012742750           1024\n#> 200    0.6469788        0.00         0.018329807           1024\n#> 201    0.6469788        0.00         0.026366509           1024\n#> 202    0.6469788        0.00         0.037926902           1024\n#> 203    0.6469788        0.00         0.054555948           1024\n#> 204    0.6469788        0.00         0.078475997           1024\n#> 205    0.6469788        0.00         0.112883789           1024\n#> 206    0.6469788        0.00         0.162377674           1024\n#> 207    0.6469788        0.00         0.233572147           1024\n#> 208    0.6469788        0.00         0.335981829           1024\n#> 209    0.6469788        0.00         0.483293024           1024\n#> 210    0.6469788        0.00         0.695192796           1024\n#> 211    0.6469788        0.00         1.000000000           1024\n#> 212    0.6419206        0.25         0.233572147           4096\n#> 213    0.6416976        0.75         0.078475997           4096\n#> 214    0.6368928        1.00         0.037926902            256\n#> 215    0.6321536        0.50         0.078475997            256\n#> 216    0.6316248        1.00         0.054555948           1024\n#> 217    0.6306399        0.50         0.112883789           1024\n#> 218    0.6293331        0.25         0.233572147           1024\n#> 219    0.6287032        0.75         0.054555948            256\n#> 220    0.6284772        0.75         0.078475997           1024\n#> 221    0.6281753        0.25         0.162377674            256\n#> 222    0.5864294        1.00         0.054555948            256\n#> 223    0.5790993        0.50         0.112883789            256\n#> 224    0.5790465        0.25         0.233572147            256\n#> 225    0.5790259        0.75         0.078475997            256\n#> 226    0.5225389        1.00         0.078475997            256\n#> 227    0.5000000        0.25         0.335981829            256\n#> 228    0.5000000        0.25         0.335981829           1024\n#> 229    0.5000000        0.25         0.335981829           4096\n#> 230    0.5000000        0.25         0.483293024            256\n#> 231    0.5000000        0.25         0.483293024           1024\n#> 232    0.5000000        0.25         0.483293024           4096\n#> 233    0.5000000        0.25         0.695192796            256\n#> 234    0.5000000        0.25         0.695192796           1024\n#> 235    0.5000000        0.25         0.695192796           4096\n#> 236    0.5000000        0.25         1.000000000            256\n#> 237    0.5000000        0.25         1.000000000           1024\n#> 238    0.5000000        0.25         1.000000000           4096\n#> 239    0.5000000        0.50         0.162377674            256\n#> 240    0.5000000        0.50         0.162377674           1024\n#> 241    0.5000000        0.50         0.162377674           4096\n#> 242    0.5000000        0.50         0.233572147            256\n#> 243    0.5000000        0.50         0.233572147           1024\n#> 244    0.5000000        0.50         0.233572147           4096\n#> 245    0.5000000        0.50         0.335981829            256\n#> 246    0.5000000        0.50         0.335981829           1024\n#> 247    0.5000000        0.50         0.335981829           4096\n#> 248    0.5000000        0.50         0.483293024            256\n#> 249    0.5000000        0.50         0.483293024           1024\n#> 250    0.5000000        0.50         0.483293024           4096\n#> 251    0.5000000        0.50         0.695192796            256\n#> 252    0.5000000        0.50         0.695192796           1024\n#> 253    0.5000000        0.50         0.695192796           4096\n#> 254    0.5000000        0.50         1.000000000            256\n#> 255    0.5000000        0.50         1.000000000           1024\n#> 256    0.5000000        0.50         1.000000000           4096\n#> 257    0.5000000        0.75         0.112883789            256\n#> 258    0.5000000        0.75         0.112883789           1024\n#> 259    0.5000000        0.75         0.112883789           4096\n#> 260    0.5000000        0.75         0.162377674            256\n#> 261    0.5000000        0.75         0.162377674           1024\n#> 262    0.5000000        0.75         0.162377674           4096\n#> 263    0.5000000        0.75         0.233572147            256\n#> 264    0.5000000        0.75         0.233572147           1024\n#> 265    0.5000000        0.75         0.233572147           4096\n#> 266    0.5000000        0.75         0.335981829            256\n#> 267    0.5000000        0.75         0.335981829           1024\n#> 268    0.5000000        0.75         0.335981829           4096\n#> 269    0.5000000        0.75         0.483293024            256\n#> 270    0.5000000        0.75         0.483293024           1024\n#> 271    0.5000000        0.75         0.483293024           4096\n#> 272    0.5000000        0.75         0.695192796            256\n#> 273    0.5000000        0.75         0.695192796           1024\n#> 274    0.5000000        0.75         0.695192796           4096\n#> 275    0.5000000        0.75         1.000000000            256\n#> 276    0.5000000        0.75         1.000000000           1024\n#> 277    0.5000000        0.75         1.000000000           4096\n#> 278    0.5000000        1.00         0.078475997           1024\n#> 279    0.5000000        1.00         0.078475997           4096\n#> 280    0.5000000        1.00         0.112883789            256\n#> 281    0.5000000        1.00         0.112883789           1024\n#> 282    0.5000000        1.00         0.112883789           4096\n#> 283    0.5000000        1.00         0.162377674            256\n#> 284    0.5000000        1.00         0.162377674           1024\n#> 285    0.5000000        1.00         0.162377674           4096\n#> 286    0.5000000        1.00         0.233572147            256\n#> 287    0.5000000        1.00         0.233572147           1024\n#> 288    0.5000000        1.00         0.233572147           4096\n#> 289    0.5000000        1.00         0.335981829            256\n#> 290    0.5000000        1.00         0.335981829           1024\n#> 291    0.5000000        1.00         0.335981829           4096\n#> 292    0.5000000        1.00         0.483293024            256\n#> 293    0.5000000        1.00         0.483293024           1024\n#> 294    0.5000000        1.00         0.483293024           4096\n#> 295    0.5000000        1.00         0.695192796            256\n#> 296    0.5000000        1.00         0.695192796           1024\n#> 297    0.5000000        1.00         0.695192796           4096\n#> 298    0.5000000        1.00         1.000000000            256\n#> 299    0.5000000        1.00         1.000000000           1024\n#> 300    0.5000000        1.00         1.000000000           4096\n```\n:::\n\n\n## Model selection\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_sff_pipeline <- sc %>% \n  ml_pipeline() %>% \n  ft_tokenizer(\"review\", \"word_list\") %>% \n  ft_stop_words_remover(\"word_list\", \"wo_stop_words\") %>% \n  ft_hashing_tf(\n    input_col = \"wo_stop_words\", \n    output_col = \"hashed_features\", \n    binary = TRUE, \n    num_features = 4096\n    ) %>% \n  ft_normalizer(\"hashed_features\", \"normal_features\") %>% \n  ft_r_formula(score ~ normal_features) %>% \n  ml_logistic_regression(elastic_net_param = 0.018, reg_param = 0.5)\n\nnew_sff_fitted <- new_sff_pipeline %>% \n  ml_fit(sff_training_data)\n```\n:::\n\n\n## Test data metrics\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnew_sff_fitted %>% \n  ml_transform(sff_testing_data) %>% \n  ml_metrics_binary()\n#> # A tibble: 2 × 3\n#>   .metric .estimator .estimate\n#>   <chr>   <chr>          <dbl>\n#> 1 roc_auc binary         0.789\n#> 2 pr_auc  binary         0.662\n```\n:::\n\n\n",
    "supporting": [
      "model_tuning_text_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}