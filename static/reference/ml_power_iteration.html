<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Spark ML -- Power Iteration Clustering — ml_power_iteration • sparklyr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Spark ML -- Power Iteration Clustering — ml_power_iteration" />
<meta property="og:description" content="Power iteration clustering (PIC) is a scalable and efficient algorithm for clustering vertices of a graph given pairwise similarities as edge properties, described in the paper &quot;Power Iteration Clustering&quot; by Frank Lin and William W. Cohen. It computes a pseudo-eigenvector of the normalized affinity matrix of the graph via power iteration and uses it to cluster vertices. spark.mllib includes an implementation of PIC using GraphX as its backend. It takes an RDD of (srcId, dstId, similarity) tuples and outputs a model with the clustering assignments. The similarities must be nonnegative. PIC assumes that the similarity measure is symmetric. A pair (srcId, dstId) regardless of the ordering should appear at most once in the input data. If a pair is missing from input, their similarity is treated as zero." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sparklyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.6.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sparklyr/sparklyr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Spark ML -- Power Iteration Clustering</h1>
    <small class="dont-index">Source: <a href='https://github.com/sparklyr/sparklyr/blob/master/R/ml_clustering_power_iteration.R'><code>R/ml_clustering_power_iteration.R</code></a></small>
    <div class="hidden name"><code>ml_power_iteration.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Power iteration clustering (PIC) is a scalable and efficient algorithm for clustering vertices of a graph given pairwise similarities as edge properties, described in the paper "Power Iteration Clustering" by Frank Lin and William W. Cohen. It computes a pseudo-eigenvector of the normalized affinity matrix of the graph via power iteration and uses it to cluster vertices. spark.mllib includes an implementation of PIC using GraphX as its backend. It takes an RDD of (srcId, dstId, similarity) tuples and outputs a model with the clustering assignments. The similarities must be nonnegative. PIC assumes that the similarity measure is symmetric. A pair (srcId, dstId) regardless of the ordering should appear at most once in the input data. If a pair is missing from input, their similarity is treated as zero.</p>
    </div>

    <pre class="usage"><span class='fu'>ml_power_iteration</span><span class='op'>(</span>
  <span class='va'>x</span>,
  k <span class='op'>=</span> <span class='fl'>4</span>,
  max_iter <span class='op'>=</span> <span class='fl'>20</span>,
  init_mode <span class='op'>=</span> <span class='st'>"random"</span>,
  src_col <span class='op'>=</span> <span class='st'>"src"</span>,
  dst_col <span class='op'>=</span> <span class='st'>"dst"</span>,
  weight_col <span class='op'>=</span> <span class='st'>"weight"</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A ‘spark_connection’  or a ‘tbl_spark’.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>The number of clusters to create.</p></td>
    </tr>
    <tr>
      <th>max_iter</th>
      <td><p>The maximum number of iterations to run.</p></td>
    </tr>
    <tr>
      <th>init_mode</th>
      <td><p>This can be either “random”, which is the default, to use a random vector as vertex properties, or “degree” to use normalized sum similarities.</p></td>
    </tr>
    <tr>
      <th>src_col</th>
      <td><p>Column in the input Spark dataframe containing 0-based indexes of all source vertices in the affinity matrix described in the PIC paper.</p></td>
    </tr>
    <tr>
      <th>dst_col</th>
      <td><p>Column in the input Spark dataframe containing 0-based indexes of all destination vertices in the affinity matrix described in the PIC paper.</p></td>
    </tr>
    <tr>
      <th>weight_col</th>
      <td><p>Column in the input Spark dataframe containing non-negative edge weights in the affinity matrix described in the PIC paper.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Optional arguments. Currently unused.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A 2-column R dataframe with columns named "id" and "cluster" describing the resulting cluster assignments</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>

<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://spark.rstudio.com/'>sparklyr</a></span><span class='op'>)</span>

<span class='va'>sc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='spark-connections.html'>spark_connect</a></span><span class='op'>(</span>master <span class='op'>=</span> <span class='st'>"local"</span><span class='op'>)</span>

<span class='va'>r1</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>n1</span> <span class='op'>&lt;-</span> <span class='fl'>80L</span>
<span class='va'>r2</span> <span class='op'>&lt;-</span> <span class='fl'>4</span>
<span class='va'>n2</span> <span class='op'>&lt;-</span> <span class='fl'>80L</span>

<span class='va'>gen_circle</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>radius</span>, <span class='va'>num_pts</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># generate evenly distributed points on a circle centered at the origin</span>
  <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>num_pts</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span>
      <span class='kw'>function</span><span class='op'>(</span><span class='va'>pt</span><span class='op'>)</span> <span class='op'>{</span>
        <span class='va'>theta</span> <span class='op'>&lt;-</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>pi</span> <span class='op'>*</span> <span class='va'>pt</span> <span class='op'>/</span> <span class='va'>num_pts</span>

        <span class='va'>radius</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>cos</a></span><span class='op'>(</span><span class='va'>theta</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span><span class='op'>(</span><span class='va'>theta</span><span class='op'>)</span><span class='op'>)</span>
      <span class='op'>}</span>
    <span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>guassian_similarity</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>pt1</span>, <span class='va'>pt2</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>dist2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>pt2</span> <span class='op'>-</span> <span class='va'>pt1</span><span class='op'>)</span> <span class='op'>^</span> <span class='fl'>2</span><span class='op'>)</span>

  <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>exp</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>dist2</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>gen_pic_data</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># generate points on 2 concentric circle centered at the origin and then</span>
  <span class='co'># compute pairwise Gaussian similarity values of all unordered pair of</span>
  <span class='co'># points</span>
  <span class='va'>n</span> <span class='op'>&lt;-</span> <span class='va'>n1</span> <span class='op'>+</span> <span class='va'>n2</span>
  <span class='va'>pts</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/append.html'>append</a></span><span class='op'>(</span><span class='fu'>gen_circle</span><span class='op'>(</span><span class='va'>r1</span>, <span class='va'>n1</span><span class='op'>)</span>, <span class='fu'>gen_circle</span><span class='op'>(</span><span class='va'>r2</span>, <span class='va'>n2</span><span class='op'>)</span><span class='op'>)</span>
  <span class='va'>num_unordered_pairs</span> <span class='op'>&lt;-</span> <span class='va'>n</span> <span class='op'>*</span> <span class='op'>(</span><span class='va'>n</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span>

  <span class='va'>src</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0L</span>, <span class='va'>num_unordered_pairs</span><span class='op'>)</span>
  <span class='va'>dst</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0L</span>, <span class='va'>num_unordered_pairs</span><span class='op'>)</span>
  <span class='va'>sim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>num_unordered_pairs</span><span class='op'>)</span>

  <span class='va'>idx</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>j</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>i</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='va'>src</span><span class='op'>[[</span><span class='va'>idx</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>i</span> <span class='op'>-</span> <span class='fl'>1L</span>
      <span class='va'>dst</span><span class='op'>[[</span><span class='va'>idx</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>j</span> <span class='op'>-</span> <span class='fl'>1L</span>
      <span class='va'>sim</span><span class='op'>[[</span><span class='va'>idx</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>guassian_similarity</span><span class='op'>(</span><span class='va'>pts</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span>, <span class='va'>pts</span><span class='op'>[[</span><span class='va'>j</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
      <span class='va'>idx</span> <span class='op'>&lt;-</span> <span class='va'>idx</span> <span class='op'>+</span> <span class='fl'>1</span>
    <span class='op'>}</span>
  <span class='op'>}</span>

  <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>src <span class='op'>=</span> <span class='va'>src</span>, dst <span class='op'>=</span> <span class='va'>dst</span>, sim <span class='op'>=</span> <span class='va'>sim</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>pic_data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='copy_to.html'>copy_to</a></span><span class='op'>(</span><span class='va'>sc</span>, <span class='fu'>gen_pic_data</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>clusters</span> <span class='op'>&lt;-</span> <span class='fu'>ml_power_iteration</span><span class='op'>(</span>
  <span class='va'>pic_data</span>, src_col <span class='op'>=</span> <span class='st'>"src"</span>, dst_col <span class='op'>=</span> <span class='st'>"dst"</span>, weight_col <span class='op'>=</span> <span class='st'>"sim"</span>, k <span class='op'>=</span> <span class='fl'>2</span>, max_iter <span class='op'>=</span> <span class='fl'>40</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>clusters</span><span class='op'>)</span>

<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Javier Luraschi, Kevin Kuo, Kevin Ushey, JJ Allaire, Hossein Falaki, Lu Wang, Andy Zhang, Yitao Li,  The Apache Software Foundation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


