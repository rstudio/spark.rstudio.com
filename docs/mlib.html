<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-0.2.443">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>sparklyr â€“ mlib</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
<!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]--><script src="site_libs/quarto-nav/quarto-nav.js"></script><script src="site_libs/quarto-nav/headroom.min.js"></script><script src="site_libs/clipboard/clipboard.min.js"></script><meta name="quarto:offset" content="./">
<script src="site_libs/quarto-search/autocomplete.umd.js"></script><script src="site_libs/quarto-search/fuse.min.js"></script><script src="site_libs/quarto-search/quarto-search.js"></script><script src="site_libs/quarto-html/quarto.js"></script><script src="site_libs/quarto-html/popper.min.js"></script><script src="site_libs/quarto-html/tippy.umd.min.js"></script><script src="site_libs/quarto-html/anchor.min.js"></script><link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link class="quarto-color-scheme" href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
<script src="site_libs/bootstrap/bootstrap.min.js"></script><link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link class="quarto-color-scheme" href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="site_libs/bootstrap/bootstrap-dark.min.css">
<script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script><script type="text/javascript">

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-20375833-3', 'auto');

  ga('send', {
    hitType: 'pageview',
    'anonymizeIp': true,
  });
  </script><link rel="stylesheet" href="styles.css">
</head>
<body class="floating">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">sparklyr</span>
  </a>
          <div class="quarto-toggle-container ms-auto">
              <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
          </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">(Untitled)</h1>
      <button type="button" class="quarto-btn-toggle btn">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-1">
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-using-sparklyr" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Using sparklyr</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-using-sparklyr">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./guides/connections.html" class="">Configuring connections</a>
</li>
          <li class="sidebar-item">
  <a href="./troubleshooting.html" class="">Troubleshooting</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-guides" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Guides</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-guides">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./dplyr.html" class="">Manipulating data</a>
</li>
          <li class="sidebar-item">
  <a href="./mlib.html" class="active">Machine Learning</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/caching.html" class="">Understanding Caching</a>
</li>
          <li class="sidebar-item">
  <a href="./deployment.html" class="">Deployment Options</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/distributed-r.html" class="">Distributed R</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/data-lakes.html" class="">Data Lakes</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/pipelines.html" class="">ML Pipelines</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/textmining.html" class="">Text mining</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/streaming.html" class="">Stream Analysis</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/arrow.html" class="">Apache Arrow</a>
</li>
          <li class="sidebar-item">
  <a href="./guides/aws-s3.html" class="">AWS S3 buckets</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-extend-sparklyr" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Extend sparklyr</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-extend-sparklyr">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./guides/h2o.html" class="">Using H2O</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-sparklyr" aria-expanded="true">
              <div class="me-auto sidebar-section-item">sparklyr</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-sparklyr">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href=".//sparklyr/news.html" class="">News</a>
</li>
          <li class="sidebar-item">
  <a href="./sparklyr/reference" class="">Reference</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="./mleap" class="">MLeap</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-mleap" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-mleap">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href=".//mleap/news.html" class="">News</a>
</li>
          <li class="sidebar-item">
  <a href="./mleap/reference" class="">Reference</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="./graphframes" class="">Graphframes</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-graphframes" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-graphframes">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href=".//graphframes/news.html" class="">News</a>
</li>
          <li class="sidebar-item">
  <a href="./graphframes/reference" class="">Reference</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="./sparkxgb" class="">XGBoost</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-xgboost" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-xgboost">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href=".//sparkxgb/news.html" class="">News</a>
</li>
          <li class="sidebar-item">
  <a href="./sparkxgb/reference" class="">Reference</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="./sparktf" class="">Tensorflow</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-tensorflow" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-tensorflow">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href=".//sparktf/news.html" class="">News</a>
</li>
          <li class="sidebar-item">
  <a href="./sparktf/reference" class="">Reference</a>
</li>
        </ul>
</div>
    </li>
  </ul>
<ul class="list-unstyled sidebar-section depth1">
<li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-deployment-examples" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Deployment Examples</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="quarto-sidebar-section-deployment-examples">
        <ul class="list-unstyled sidebar-item-contents">
<li class="sidebar-item">
  <a href="./examples/stand-alone-aws.html" class="">Standalone cluster</a>
</li>
          <li class="sidebar-item">
  <a href="./examples/yarn-cluster-emr.html" class="">YARN cluster</a>
</li>
          <li class="sidebar-item">
  <a href="./examples/cloudera-aws.html" class="">Cloudera cluster</a>
</li>
          <li class="sidebar-item">
  <a href="./examples/databricks-cluster-local.html" class="">Databricks cluster</a>
</li>
          <li class="sidebar-item">
  <a href="./examples/qubole-overview.html" class="">Qubole cluster</a>
</li>
        </ul>
</div>
    </li>
  </ul>
</ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
      <nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
<ul>
<li>
<a href="#spark-machine-learning-library-mllib" class="nav-link active" data-scroll-target="#spark-machine-learning-library-mllib">Spark Machine Learning Library (MLlib)</a>
<ul class="collapse">
<li><a href="#overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
<li>
<a href="#algorithms" class="nav-link" data-scroll-target="#algorithms">Algorithms</a>
<ul class="collapse">
<li><a href="#formulas" class="nav-link" data-scroll-target="#formulas">Formulas</a></li>
<li><a href="#options" class="nav-link" data-scroll-target="#options">Options</a></li>
</ul>
</li>
<li><a href="#transformers" class="nav-link" data-scroll-target="#transformers">Transformers</a></li>
<li>
<a href="#examples" class="nav-link" data-scroll-target="#examples">Examples</a>
<ul class="collapse">
<li><a href="#k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering">K-Means Clustering</a></li>
<li><a href="#linear-regression" class="nav-link" data-scroll-target="#linear-regression">Linear Regression</a></li>
<li><a href="#logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic Regression</a></li>
<li><a href="#pca" class="nav-link" data-scroll-target="#pca">PCA</a></li>
<li><a href="#random-forest" class="nav-link" data-scroll-target="#random-forest">Random Forest</a></li>
<li><a href="#sdf-partitioning" class="nav-link" data-scroll-target="#sdf-partitioning">SDF Partitioning</a></li>
<li><a href="#ft-string-indexing" class="nav-link" data-scroll-target="#ft-string-indexing">FT String Indexing</a></li>
<li><a href="#sdf-mutate" class="nav-link" data-scroll-target="#sdf-mutate">SDF Mutate</a></li>
<li><a href="#example-workflow" class="nav-link" data-scroll-target="#example-workflow">Example Workflow</a></li>
</ul>
</li>
</ul>
</li>
</ul></nav>
</div>
<!-- main -->
<main class="content"><section id="spark-machine-learning-library-mllib" class="level1"><h1>Spark Machine Learning Library (MLlib)</h1>
<section id="overview" class="level2"><h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p><strong>sparklyr</strong> provides bindings to Sparkâ€™s distributed <a href="https://spark.apache.org/docs/latest/mllib-guide.html">machine learning</a> library. In particular, sparklyr allows you to access the machine learning routines provided by the <a href="https://spark.apache.org/docs/latest/ml-guide">spark.ml</a> package. Together with sparklyrâ€™s <a href="./dplyr">dplyr</a> interface, you can easily create and tune machine learning workflows on Spark, orchestrated entirely within R.</p>
<p>sparklyr provides three families of functions that you can use with Spark machine learning:</p>
<ul>
<li>Machine learning algorithms for analyzing data (<code>ml_*</code>)</li>
<li>Feature transformers for manipulating individual features (<code>ft_*</code>)</li>
<li>Functions for manipulating Spark DataFrames (<code>sdf_*</code>)</li>
</ul>
<p>An analytic workflow with sparklyr might be composed of the following stages. For an example see <a href="#example-workflow">Example Workflow</a>.</p>
<ol type="1">
<li>Perform SQL queries through the sparklyr <a href="./dplyr">dplyr</a> interface,</li>
<li>Use the <code>sdf_*</code> and <code>ft_*</code> family of functions to generate new columns, or partition your data set,</li>
<li>Choose an appropriate machine learning algorithm from the <code>ml_*</code> family of functions to model your data,</li>
<li>Inspect the quality of your model fit, and use it to make predictions with new data.</li>
<li>Collect the results for visualization and further analysis in R</li>
</ol></section><section id="algorithms" class="level2"><h2 class="anchored" data-anchor-id="algorithms">Algorithms</h2>
<p>Sparkâ€™s machine learning library can be accessed from sparklyr through the <code>ml_*</code> set of functions:</p>
<table class="table">
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="./reference/ml_kmeans"><code>ml_kmeans</code></a></td>
<td>K-Means Clustering</td>
</tr>
<tr class="even">
<td><a href="./reference/ml_linear_regression"><code>ml_linear_regression</code></a></td>
<td>Linear Regression</td>
</tr>
<tr class="odd">
<td><a href="./reference/ml_logistic_regression"><code>ml_logistic_regression</code></a></td>
<td>Logistic Regression</td>
</tr>
<tr class="even">
<td><a href="./reference/ml_survival_regression"><code>ml_survival_regression</code></a></td>
<td>Survival Regression</td>
</tr>
<tr class="odd">
<td><a href="./reference/ml_generalized_linear_regression"><code>ml_generalized_linear_regression</code></a></td>
<td>Generalized Linear Regression</td>
</tr>
<tr class="even">
<td><a href="./reference/ml_decision_tree"><code>ml_decision_tree</code></a></td>
<td>Decision Trees</td>
</tr>
<tr class="odd">
<td><a href="./reference/ml_random_forest"><code>ml_random_forest</code></a></td>
<td>Random Forests</td>
</tr>
<tr class="even">
<td><a href="./reference/ml_gradient_boosted_trees"><code>ml_gradient_boosted_trees</code></a></td>
<td>Gradient-Boosted Trees</td>
</tr>
<tr class="odd">
<td><a href="./reference/ml_pca"><code>ml_pca</code></a></td>
<td>Principal Components Analysis</td>
</tr>
<tr class="even">
<td><a href="./reference/ml_naive_bayes"><code>ml_naive_bayes</code></a></td>
<td>Naive-Bayes</td>
</tr>
<tr class="odd">
<td><a href="./reference/ml_multilayer_perceptron"><code>ml_multilayer_perceptron</code></a></td>
<td>Multilayer Perceptron</td>
</tr>
<tr class="even">
<td><a href="./reference/ml_lda"><code>ml_lda</code></a></td>
<td>Latent Dirichlet Allocation</td>
</tr>
<tr class="odd">
<td><a href="./reference/ml_lda"><code>ml_one_vs_rest</code></a></td>
<td>One vs Rest</td>
</tr>
</tbody>
</table>
<section id="formulas" class="level3"><h3 class="anchored" data-anchor-id="formulas">Formulas</h3>
<p>The <code>ml_*</code> functions take the arguments <code>response</code> and <code>features</code>. But <code>features</code> can also be a formula with main effects (it currently does not accept interaction terms). The intercept term can be omitted by using <code>-1</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Equivalent statements</span>
<span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_linear_regression.html">ml_linear_regression</a></span><span class="op">(</span><span class="va">z</span> <span class="op">~</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span>
<span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_linear_regression.html">ml_linear_regression</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="cn">FALSE</span>, response <span class="op">=</span> <span class="st">"z"</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</section><section id="options" class="level3"><h3 class="anchored" data-anchor-id="options">Options</h3>
<p>The Spark model output can be modified with the <code>ml_options</code> argument in the <code>ml_*</code> functions. The <code>ml_options</code> is an <em>experts only</em> interface for tweaking the model output. For example, <code>model.transform</code> can be used to mutate the Spark model object before the fit is performed.</p>
</section></section><section id="transformers" class="level2"><h2 class="anchored" data-anchor-id="transformers">Transformers</h2>
<p>A model is often fit not on a dataset as-is, but instead on some transformation of that dataset. Spark provides <a href="http://spark.apache.org/docs/latest/ml-features">feature transformers</a>, facilitating many common transformations of data within a Spark DataFrame, and sparklyr exposes these within the <code>ft_*</code> family of functions. These routines generally take one or more input columns, and generate a new output column formed as a transformation of those columns.</p>
<table class="table">
<colgroup>
<col width="38%">
<col width="61%">
</colgroup>
<thead><tr class="header">
<th>
Function
</th>
<th>
Description
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<a href="./reference/ft_binarizer"><code>ft_binarizer</code></a>
</td>
<td>
Threshold numerical features to binary (0/1) feature
</td>
</tr>
<tr class="even">
<td>
<a href="./reference/ft_bucketizer"><code>ft_bucketizer</code></a>
</td>
<td>
Bucketizer transforms a column of continuous features to a column of feature buckets
</td>
</tr>
<tr class="odd">
<td>
<a href="./reference/ft_discrete_cosine_transform"><code>ft_discrete_cosine_transform</code></a>
</td>
<td>
Transforms a length NN real-valued sequence in the time domain into another length NN real-valued sequence in the frequency domain
</td>
</tr>
<tr class="even">
<td>
<a href="./reference/ft_elementwise_product"><code>ft_elementwise_product</code></a>
</td>
<td>
Multiplies each input vector by a provided weight vector, using element-wise multiplication.
</td>
</tr>
<tr class="odd">
<td>
<a href="./reference/ft_index_to_string"><code>ft_index_to_string</code></a>
</td>
<td>
Maps a column of label indices back to a column containing the original labels as strings
</td>
</tr>
<tr class="even">
<td>
<a href="./reference/ft_quantile_discretizer"><code>ft_quantile_discretizer</code></a>
</td>
<td>
Takes a column with continuous features and outputs a column with binned categorical features
</td>
</tr>
<tr class="odd">
<td>
<a href="./reference/sql-transformer"><code>sql_transformer</code></a>
</td>
<td>
Implements the transformations which are defined by a SQL statement
</td>
</tr>
<tr class="even">
<td>
<a href="./reference/ft_string_indexer"><code>ft_string_indexer</code></a>
</td>
<td>
Encodes a string column of labels to a column of label indices
</td>
</tr>
<tr class="odd">
<td>
<a href="./reference/ft_vector_assembler"><code>ft_vector_assembler</code></a>
</td>
<td>
Combines a given list of columns into a single vector column
</td>
</tr>
</tbody>
</table></section><section id="examples" class="level2"><h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>We will use the <code>iris</code> data set to examine a handful of learning algorithms and transformers. The iris data set measures attributes for 150 flowers in 3 different species of iris.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spark.rstudio.com/">sparklyr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: package 'sparklyr' was built under R version 3.4.3</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'

## The following objects are masked from 'package:stats':
## 
##     filter, lag

## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/spark-connections.html">spark_connect</a></span><span class="op">(</span>master <span class="op">=</span> <span class="st">"local"</span><span class="op">)</span></code></pre></div>
<pre><code>## * Using Spark: 2.1.0</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">iris_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html">copy_to</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">iris</span>, <span class="st">"iris"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">iris_tbl</span></code></pre></div>
<pre><code>## # Source:   table&lt;iris&gt; [?? x 5]
## # Database: spark_connection
##    Sepal_Length Sepal_Width Petal_Length Petal_Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;chr&gt;
##  1          5.1         3.5          1.4         0.2  setosa
##  2          4.9         3.0          1.4         0.2  setosa
##  3          4.7         3.2          1.3         0.2  setosa
##  4          4.6         3.1          1.5         0.2  setosa
##  5          5.0         3.6          1.4         0.2  setosa
##  6          5.4         3.9          1.7         0.4  setosa
##  7          4.6         3.4          1.4         0.3  setosa
##  8          5.0         3.4          1.5         0.2  setosa
##  9          4.4         2.9          1.4         0.2  setosa
## 10          4.9         3.1          1.5         0.1  setosa
## # ... with more rows</code></pre>
<section id="k-means-clustering" class="level3"><h3 class="anchored" data-anchor-id="k-means-clustering">K-Means Clustering</h3>
<p>Use Sparkâ€™s <a href="http://spark.apache.org/docs/latest/ml-clustering.html#k-means">K-means clustering</a> to partition a dataset into groups. K-means clustering partitions points into <code>k</code> groups, such that the sum of squares from points to the assigned cluster centers is minimized.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">kmeans_model</span> <span class="op">&lt;-</span> <span class="va">iris_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_kmeans.html">ml_kmeans</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">3</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Petal_Length"</span>, <span class="st">"Petal_Width"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## * No rows dropped by 'na.omit' call</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># print our model fit</span>
<span class="va">kmeans_model</span></code></pre></div>
<pre><code>## K-means clustering with 3 clusters
## 
## Cluster centers:
##   Petal_Width Petal_Length
## 1    1.359259     4.292593
## 2    0.246000     1.462000
## 3    2.047826     5.626087
## 
## Within Set Sum of Squared Errors =  31.41289</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># predict the associated class</span>
<span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml-transform-methods.html">ml_predict</a></span><span class="op">(</span><span class="va">kmeans_model</span>, <span class="va">iris_tbl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">collect</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">$</span><span class="va">Species</span>, <span class="va">predicted</span><span class="op">$</span><span class="va">prediction</span><span class="op">)</span></code></pre></div>
<pre><code>##             
##               0  1  2
##   setosa      0 50  0
##   versicolor 48  0  2
##   virginica   6  0 44</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># plot cluster membership</span>
<span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml-transform-methods.html">ml_predict</a></span><span class="op">(</span><span class="va">kmeans_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Petal_Length</span>, <span class="va">Petal_Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Petal_Width</span>, <span class="va">Petal_Length</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">prediction</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
             size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">kmeans_model</span><span class="op">$</span><span class="va">centers</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Petal_Width</span>, <span class="va">Petal_Length</span><span class="op">)</span>,
             col <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/muted.html">muted</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">)</span>,
             pch <span class="op">=</span> <span class="st">'x'</span>, size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Predicted Cluster"</span>,
                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Cluster"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Petal Length"</span>,
    y <span class="op">=</span> <span class="st">"Petal Width"</span>,
    title <span class="op">=</span> <span class="st">"K-Means Clustering"</span>,
    subtitle <span class="op">=</span> <span class="st">"Use Spark.ML to predict cluster membership with the iris dataset."</span>
  <span class="op">)</span></code></pre></div>
<p><img src="guides-mllib_files/figure-markdown_github/unnamed-chunk-5-1.png" class="img-fluid"></p>
</section><section id="linear-regression" class="level3"><h3 class="anchored" data-anchor-id="linear-regression">Linear Regression</h3>
<p>Use Sparkâ€™s <a href="http://spark.apache.org/docs/latest/ml-classification-regression.html#linear-regression">linear regression</a> to model the linear relationship between a response variable and one or more explanatory variables.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="va">iris_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Petal_Width</span>, <span class="va">Petal_Length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_linear_regression.html">ml_linear_regression</a></span><span class="op">(</span><span class="va">Petal_Length</span> <span class="op">~</span> <span class="va">Petal_Width</span><span class="op">)</span></code></pre></div>
<pre><code>## * No rows dropped by 'na.omit' call</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">iris_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Petal_Width</span>, <span class="va">Petal_Length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">collect</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Petal_Length</span>, <span class="va">Petal_Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Petal_Width</span>, <span class="va">Petal_Length</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">[[</span><span class="st">"Petal_Width"</span><span class="op">]</span><span class="op">]</span>,
                    intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lm_model</span><span class="op">)</span><span class="op">[[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,
                color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Petal Width"</span>,
    y <span class="op">=</span> <span class="st">"Petal Length"</span>,
    title <span class="op">=</span> <span class="st">"Linear Regression: Petal Length ~ Petal Width"</span>,
    subtitle <span class="op">=</span> <span class="st">"Use Spark.ML linear regression to predict petal length as a function of petal width."</span>
  <span class="op">)</span></code></pre></div>
<p><img src="guides-mllib_files/figure-markdown_github/unnamed-chunk-6-1.png" class="img-fluid"></p>
</section><section id="logistic-regression" class="level3"><h3 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h3>
<p>Use Sparkâ€™s <a href="http://spark.apache.org/docs/latest/ml-classification-regression.html#logistic-regression">logistic regression</a> to perform logistic regression, modeling a binary outcome as a function of one or more explanatory variables.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Prepare beaver dataset</span>
<span class="va">beaver</span> <span class="op">&lt;-</span> <span class="va">beaver2</span>
<span class="va">beaver</span><span class="op">$</span><span class="va">activ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">beaver</span><span class="op">$</span><span class="va">activ</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Non-Active"</span>, <span class="st">"Active"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html">copy_to</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">beaver</span>, <span class="st">"beaver"</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   table&lt;beaver&gt; [?? x 4]
## # Database: spark_connection
##      day  time  temp      activ
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;chr&gt;
##  1   307   930 36.58 Non-Active
##  2   307   940 36.73 Non-Active
##  3   307   950 36.93 Non-Active
##  4   307  1000 37.15 Non-Active
##  5   307  1010 37.23 Non-Active
##  6   307  1020 37.24 Non-Active
##  7   307  1030 37.24 Non-Active
##  8   307  1040 36.90 Non-Active
##  9   307  1050 36.95 Non-Active
## 10   307  1100 36.89 Non-Active
## # ... with more rows</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">beaver_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"beaver"</span><span class="op">)</span>

<span class="va">glm_model</span> <span class="op">&lt;-</span> <span class="va">beaver_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>binary_response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">activ</span> <span class="op">==</span> <span class="st">"Active"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_logistic_regression.html">ml_logistic_regression</a></span><span class="op">(</span><span class="va">binary_response</span> <span class="op">~</span> <span class="va">temp</span><span class="op">)</span></code></pre></div>
<pre><code>## * No rows dropped by 'na.omit' call</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">glm_model</span></code></pre></div>
<pre><code>## Call: binary_response ~ temp
## 
## Coefficients:
## (Intercept)        temp 
##  -550.52331    14.69184</code></pre>
</section><section id="pca" class="level3"><h3 class="anchored" data-anchor-id="pca">PCA</h3>
<p>Use Sparkâ€™s <a href="https://spark.apache.org/docs/latest/mllib-dimensionality-reduction">Principal Components Analysis (PCA)</a> to perform dimensionality reduction. PCA is a statistical method to find a rotation such that the first coordinate has the largest variance possible, and each succeeding coordinate in turn has the largest variance possible.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">pca_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"iris"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ft_pca.html">ml_pca</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## * No rows dropped by 'na.omit' call</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pca_model</span><span class="op">)</span></code></pre></div>
<pre><code>## Explained variance:
## 
##         PC1         PC2         PC3         PC4 
## 0.924618723 0.053066483 0.017102610 0.005212184 
## 
## Rotation:
##                      PC1         PC2         PC3        PC4
## Sepal_Length -0.36138659 -0.65658877  0.58202985  0.3154872
## Sepal_Width   0.08452251 -0.73016143 -0.59791083 -0.3197231
## Petal_Length -0.85667061  0.17337266 -0.07623608 -0.4798390
## Petal_Width  -0.35828920  0.07548102 -0.54583143  0.7536574</code></pre>
</section><section id="random-forest" class="level3"><h3 class="anchored" data-anchor-id="random-forest">Random Forest</h3>
<p>Use Sparkâ€™s <a href="https://spark.apache.org/docs/latest/ml-classification-regression.html#random-forest-regression">Random Forest</a> to perform regression or multiclass classification.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="va">iris_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_random_forest.html">ml_random_forest</a></span><span class="op">(</span><span class="va">Species</span> <span class="op">~</span> <span class="va">Petal_Length</span> <span class="op">+</span> <span class="va">Petal_Width</span>, type <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span></code></pre></div>
<pre><code>## * No rows dropped by 'na.omit' call</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">rf_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/sdf-transform-methods.html">sdf_predict</a></span><span class="op">(</span><span class="va">rf_model</span>, <span class="va">iris_tbl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ft_string_indexer.html">ft_string_indexer</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Species_idx"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">collect</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rf_predict</span><span class="op">$</span><span class="va">Species_idx</span>, <span class="va">rf_predict</span><span class="op">$</span><span class="va">prediction</span><span class="op">)</span></code></pre></div>
<pre><code>##    
##      0  1  2
##   0 49  1  0
##   1  0 50  0
##   2  0  0 50</code></pre>
</section><section id="sdf-partitioning" class="level3"><h3 class="anchored" data-anchor-id="sdf-partitioning">SDF Partitioning</h3>
<p>Split a Spark DataFrame into training, test datasets.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">partitions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"iris"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/sdf_random_split.html">sdf_partition</a></span><span class="op">(</span>training <span class="op">=</span> <span class="fl">0.75</span>, test <span class="op">=</span> <span class="fl">0.25</span>, seed <span class="op">=</span> <span class="fl">1099</span><span class="op">)</span>

<span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">partitions</span><span class="op">$</span><span class="va">training</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_linear_regression.html">ml_linear_regression</a></span><span class="op">(</span><span class="va">Petal_Length</span> <span class="op">~</span> <span class="va">Petal_Width</span><span class="op">)</span></code></pre></div>
<pre><code>## * No rows dropped by 'na.omit' call</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">estimate_mse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/sdf-transform-methods.html">sdf_predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>resid <span class="op">=</span> <span class="va">Petal_Length</span> <span class="op">-</span> <span class="va">prediction</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">resid</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">collect</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">partitions</span>, <span class="va">estimate_mse</span><span class="op">)</span></code></pre></div>
<pre><code>## $training.mse
## [1] 0.2374596
## 
## $test.mse
## [1] 0.1898848</code></pre>
</section><section id="ft-string-indexing" class="level3"><h3 class="anchored" data-anchor-id="ft-string-indexing">FT String Indexing</h3>
<p>Use <code>ft_string_indexer</code> and <code>ft_index_to_string</code> to convert a character column into a numeric column and back again.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">ft_string2idx</span> <span class="op">&lt;-</span> <span class="va">iris_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ft_string_indexer.html">ft_string_indexer</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Species_idx"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ft_index_to_string.html">ft_index_to_string</a></span><span class="op">(</span><span class="st">"Species_idx"</span>, <span class="st">"Species_remap"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">collect</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">ft_string2idx</span><span class="op">$</span><span class="va">Species</span>, <span class="va">ft_string2idx</span><span class="op">$</span><span class="va">Species_remap</span><span class="op">)</span></code></pre></div>
<pre><code>##             
##              setosa versicolor virginica
##   setosa         50          0         0
##   versicolor      0         50         0
##   virginica       0          0        50</code></pre>
</section><section id="sdf-mutate" class="level3"><h3 class="anchored" data-anchor-id="sdf-mutate">SDF Mutate</h3>
<p><a href="./reference/sdf_mutate">sdf_mutate</a> is provided as a helper function, to allow you to use feature transformers. For example, the previous code snippet could have been written as:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">ft_string2idx</span> <span class="op">&lt;-</span> <span class="va">iris_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sdf_mutate</span><span class="op">(</span>Species_idx <span class="op">=</span> <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ft_string_indexer.html">ft_string_indexer</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sdf_mutate</span><span class="op">(</span>Species_remap <span class="op">=</span> <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ft_index_to_string.html">ft_index_to_string</a></span><span class="op">(</span><span class="va">Species_idx</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">collect</span>
  
<span class="va">ft_string2idx</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Species</span>, <span class="va">Species_idx</span>, <span class="va">Species_remap</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">distinct</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##      Species Species_idx Species_remap
##        &lt;chr&gt;       &lt;dbl&gt;         &lt;chr&gt;
## 1     setosa           2        setosa
## 2 versicolor           0    versicolor
## 3  virginica           1     virginica</code></pre>
</section><section id="example-workflow" class="level3"><h3 class="anchored" data-anchor-id="example-workflow">Example Workflow</h3>
<p>Letâ€™s walk through a simple example to demonstrate the use of Sparkâ€™s machine learning algorithms within R. Weâ€™ll use <a href="./reference/ml_linear_regression">ml_linear_regression</a> to fit a linear regression model. Using the built-in <code>mtcars</code> dataset, weâ€™ll try to predict a carâ€™s fuel consumption (<code>mpg</code>) based on its weight (<code>wt</code>), and the number of cylinders the engine contains (<code>cyl</code>).</p>
<p>First, we will copy the <code>mtcars</code> dataset into Spark.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">mtcars_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html">copy_to</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">mtcars</span>, <span class="st">"mtcars"</span><span class="op">)</span></code></pre></div>
<p>Transform the data with Spark SQL, feature transformers, and DataFrame functions.</p>
<ol type="1">
<li>Use Spark SQL to remove all cars with horsepower less than 100</li>
<li>Use Spark feature transformers to bucket cars into two groups based on cylinders</li>
<li>Use Spark DataFrame functions to partition the data into test and training</li>
</ol>
<p>Then fit a linear model using spark ML. Model MPG as a function of weight and cylinders.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># transform our data set, and then partition into 'training', 'test'</span>
<span class="va">partitions</span> <span class="op">&lt;-</span> <span class="va">mtcars_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">hp</span> <span class="op">&gt;=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu">sdf_mutate</span><span class="op">(</span>cyl8 <span class="op">=</span> <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ft_bucketizer.html">ft_bucketizer</a></span><span class="op">(</span><span class="va">cyl</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">8</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/sdf_random_split.html">sdf_partition</a></span><span class="op">(</span>training <span class="op">=</span> <span class="fl">0.5</span>, test <span class="op">=</span> <span class="fl">0.5</span>, seed <span class="op">=</span> <span class="fl">888</span><span class="op">)</span>

<span class="co"># fit a linear mdoel to the training dataset</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">partitions</span><span class="op">$</span><span class="va">training</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/ml_linear_regression.html">ml_linear_regression</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">wt</span> <span class="op">+</span> <span class="va">cyl</span><span class="op">)</span></code></pre></div>
<pre><code>## * No rows dropped by 'na.omit' call</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># summarize the model</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Call: ml_linear_regression(., mpg ~ wt + cyl)
## 
## Deviance Residuals::
##     Min      1Q  Median      3Q     Max 
## -2.0947 -1.2747 -0.1129  1.0876  2.2185 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 33.79558    2.67240 12.6462 4.92e-07 ***
## wt          -1.59625    0.73729 -2.1650  0.05859 .  
## cyl         -1.58036    0.49670 -3.1817  0.01115 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-Squared: 0.8267
## Root Mean Squared Error: 1.437</code></pre>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> suggests that our model is a fairly good fit, and that both a cars weight, as well as the number of cylinders in its engine, will be powerful predictors of its average fuel consumption. (The model suggests that, on average, heavier cars consume more fuel.)</p>
<p>Letâ€™s use our Spark model fit to predict the average fuel consumption on our test data set, and compare the predicted response with the true measured fuel consumption. Weâ€™ll build a simple ggplot2 plot that will allow us to inspect the quality of our predictions.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Score the data</span>
<span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edgararuiz.github.io/spark.rstudio.com/sparklyr/reference/sdf-transform-methods.html">sdf_predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">partitions</span><span class="op">$</span><span class="va">test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="va">collect</span>

<span class="co"># Plot the predicted versus actual mpg</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mpg</span>, y <span class="op">=</span> <span class="va">prediction</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="st">"dashed"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Actual Fuel Consumption"</span>,
    y <span class="op">=</span> <span class="st">"Predicted Fuel Consumption"</span>,
    title <span class="op">=</span> <span class="st">"Predicted vs. Actual Fuel Consumption"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="guides-mllib_files/figure-markdown_github/unnamed-chunk-15-1.png" class="img-fluid"></p>
<p>Although simple, our model appears to do a fairly good job of predicting a carâ€™s average fuel consumption.</p>
<p>As you can see, we can easily and effectively combine feature transformers, machine learning algorithms, and Spark DataFrame functions into a complete analysis with Spark and R.</p>


</section></section></section></main><!-- /main --><script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      return window.localStorage.getItem("quarto-color-scheme");
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = null;
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.id = "quarto-color-scheme-toggle";
    a.classList.add('top-right');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->


</body>
</html>
