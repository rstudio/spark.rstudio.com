<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-(Local Development)">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>sparklyr â€“ Using sparklyr with Databricks</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.min.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/clipboard.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <script src="../site_libs/quarto-html/quarto-html.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/bootstrap/bootstrap-dark.min.css">
  
  <script type="text/javascript">

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-20375833-3', 'auto');

  ga('send', {
    hitType: 'pageview',
    'anonymizeIp': true,
  });
  </script>
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="navbar navbar-expand-lg navbar-light bg-light ">
    <div class="container-fluid">
  <a class="navbar-brand" href="../index.html">
    sparklyr
  </a>
      <div>
        <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;"><i class="bi"></i></a>
      </div>
      <form class="d-flex mb-0">
  <input id="quarto-search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>
  </div> <!-- /container-fluid -->
</nav>
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">Using sparklyr with Databricks</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto py-2 docked  overflow-scroll">
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-3 px-3">
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#usingsparklyr-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Using sparklyr</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="usingsparklyr-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../guides/connections.html" class="">Configuring connections</a>
</li>
          <li class="sidebar-item">
  <a href="../troubleshooting.html" class="">Troubleshooting</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#guides-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Guides</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="guides-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../dplyr.html" class="">Manipulating data</a>
</li>
          <li class="sidebar-item">
  <a href="../mlib.html" class="">Machine Learning</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/caching.html" class="">Understanding Caching</a>
</li>
          <li class="sidebar-item">
  <a href="../deployment.html" class="">Deployment Options</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/distributed-r.html" class="">Distributed R</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/data-lakes.html" class="">Data Lakes</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/pipelines.html" class="">ML Pipelines</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/textmining.html" class="">Text mining</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/streaming.html" class="">Stream Analysis</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/arrow.html" class="">Apache Arrow</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/aws-s3.html" class="">AWS S3 buckets</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#extendsparklyr-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Extend sparklyr</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="extendsparklyr-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../guides/h2o.html" class="">Using H2O</a>
</li>
          <li class="sidebar-item">
  <a href="../graphframes.html" class="">Graph Analysis</a>
</li>
          <li class="sidebar-item">
  <a href="../guides/mleap.html" class="">Production pipelines</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#deploymentexamples-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Deployment Examples</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="deploymentexamples-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../examples/stand-alone-aws.html" class="">Standalone cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/yarn-cluster-emr.html" class="">YARN cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/cloudera-aws.html" class="">Cloudera cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/databricks-cluster-local.html" class="">Databricks cluster</a>
</li>
          <li class="sidebar-item">
  <a href="../examples/qubole-overview.html" class="">Qubole cluster</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto ">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#reference-collapse" aria-expanded="true">
              <div class="me-auto  sidebar-section-item">Reference</div>
            <div><i class="bi bi-chevron-right ms-2 "></i></div>
            </a>
        </div>
      <div class="collapse  show" id="reference-collapse">
        <ul class="list-unstyled sidebar-item-contents">
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class="col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
<li><a href="#using-rstudio-team-with-databricks" class="nav-link" data-scroll-target="#using-rstudio-team-with-databricks">Using RStudio Team with Databricks</a></li>
<li><a href="#best-practices-for-working-with-databricks" class="nav-link" data-scroll-target="#best-practices-for-working-with-databricks">Best practices for working with Databricks</a></li>
<li><a href="#using-rstudio-workbench-with-databricks" class="nav-link" data-scroll-target="#using-rstudio-workbench-with-databricks">Using RStudio Workbench with Databricks</a>
<ul class="collapse">
<li><a href="#option-1---connecting-to-databricks-remotely" class="nav-link" data-scroll-target="#option-1---connecting-to-databricks-remotely">Option 1 - Connecting to Databricks remotely</a></li>
<li><a href="#option-2---working-inside-of-databricks" class="nav-link" data-scroll-target="#option-2---working-inside-of-databricks">Option 2 - Working inside of Databricks</a></li>
</ul></li>
<li><a href="#using-rstudio-connect-with-databricks" class="nav-link" data-scroll-target="#using-rstudio-connect-with-databricks">Using RStudio Connect with Databricks</a></li>
<li><a href="#using-rstudio-package-manager-with-databricks" class="nav-link" data-scroll-target="#using-rstudio-package-manager-with-databricks">Using RStudio Package Manager with Databricks</a></li>
</ul>
</nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-0">
<main>
<header id="title-block-header">
<h1 class="title d-none d-lg-block display-7">Using sparklyr with Databricks</h1>
</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This documentation demonstrates how to use <code>sparklyr</code> with Apache Spark in Databricks along with RStudio Team, RStudio Workbench, RStudio Connect, and RStudio Package Manager.</p>
</section>
<section id="using-rstudio-team-with-databricks" class="level2">
<h2 class="anchored" data-anchor-id="using-rstudio-team-with-databricks">Using RStudio Team with Databricks</h2>
<p>RStudio Team is a bundle of our popular professional software for developing data science projects, publishing data products, and managing packages.</p>
<p>RStudio Team and <code>sparklyr</code> can be used with Databricks to work with large datasets and distributed computations with Apache Spark. The most common use case is to perform interactive analysis and exploratory development with RStudio Workbench and <code>sparklyr</code>; write out the results to a database, file system, or cloud storage; then publish apps, reports, and APIs to RStudio Connect that query and access the results.</p>
<p><img src="../images/deployment/databricks/rstudio-databricks-architecture.png" width="800px" align="center"></p>
<p>The sections below describe best practices and different options for configuring specific RStudio products to work with Databricks.</p>
</section>
<section id="best-practices-for-working-with-databricks" class="level2">
<h2 class="anchored" data-anchor-id="best-practices-for-working-with-databricks">Best practices for working with Databricks</h2>
<ul>
<li><strong>Maintain separate installation environments</strong> - Install RStudio Workbench, RStudio Connect, and RStudio Package Manager outside of the Databricks cluster so that they are not limited to the compute resources or ephemeral nature of Databricks clusters.</li>
<li><strong>Connect to Databricks remotely</strong> - Work with Databricks as a remote compute resource, similar to how you would connect remotely to external databases, data sources, and storage systems. This can be accomplished using Databricks Connect (as described in the <a href="#option-1---connecting-to-databricks-remotely">Connecting to Databricks remotely</a> section below) or by performing SQL queries with JDBC/ODBC using the Databricks Spark SQL Driver on <a href="https://docs.databricks.com/integrations/bi/jdbc-odbc-bi.html">AWS</a> or <a href="https://docs.microsoft.com/en-us/azure/databricks/integrations/bi/jdbc-odbc-bi">Azure</a>.</li>
<li><strong>Restrict workloads to interactive analysis</strong> - Only perform workloads related to exploratory or interactive analysis with Spark, then write the results to a database, file system, or cloud storage for more efficient retrieval in apps, reports, and APIs.</li>
<li><strong>Load and query results efficiently</strong> - Because of the nature of Spark computations and the associated overhead, Shiny apps that use Spark on the backend tend to have performance and runtime issues; consider reading the results from a database, file system, or cloud storage instead.</li>
</ul>
</section>
<section id="using-rstudio-workbench-with-databricks" class="level2">
<h2 class="anchored" data-anchor-id="using-rstudio-workbench-with-databricks">Using RStudio Workbench with Databricks</h2>
<p>There are two options for using <code>sparklyr</code> and RStudio Workbench with Databricks:</p>
<ul>
<li>Option 1: <a href="#option-1---connecting-to-databricks-remotely">Connecting to Databricks remotely</a> (Recommended Option)</li>
<li>Option 2: <a href="#option-2---working-inside-of-databricks">Working inside of Databricks</a> (Alternative Option)</li>
</ul>
<section id="option-1---connecting-to-databricks-remotely" class="level3">
<h3 class="anchored">Option 1 - Connecting to Databricks remotely</h3>
<p>With this configuration, RStudio Workbench is installed outside of the Spark cluster and allows users to connect to Spark remotely using <code>sparklyr</code> with <a href="https://docs.databricks.com/dev-tools/databricks-connect.html">Databricks Connect</a>.</p>
<p>This is the recommended configuration because it targets separate environments, involves a typical configuration process, avoids resource contention, and allows RStudio Workbench to connect to Databricks as well as other remote storage and compute resources.</p>
<a href="../examples/databricks-cluster-remote">
<h2 class="anchored" data-anchor-id="option-1---connecting-to-databricks-remotely">
View steps for connecting to Databricks remotely
</h2>
</a><p><a href="../examples/databricks-cluster-remote"></a></p>
<p><a href="../examples/databricks-cluster-remote"> <img src="../images/deployment/databricks/rstudio-databricks-remote.png" width="800px" align="center"> </a></p>
</section>
<section id="option-2---working-inside-of-databricks" class="level3">
<h3 class="anchored">Option 2 - Working inside of Databricks</h3>
<p>If you cannot work with Spark remotely, you should install RStudio Workbench on the Driver node of a long-running, persistent Databricks cluster as opposed to a worker node or an ephemeral cluster.</p>
<p>With this configuration, RStudio Workbench is installed on the Spark driver node and allows users to connect to Spark locally using <code>sparklyr</code>.</p>
<p>This configuration can result in increased complexity, limited connectivity to other storage and compute resources, resource contention between RStudio Workbench and Databricks, and maintenance concerns due to the ephemeral nature of Databricks clusters.</p>
<a href="../examples/databricks-cluster-local">
<h2 class="anchored" data-anchor-id="option-2---working-inside-of-databricks">
View steps for working inside of Databricks
</h2>
</a><p><a href="../examples/databricks-cluster-local"></a></p>
<p><a href="../examples/databricks-cluster-local"> <img src="../images/deployment/databricks/rstudio-databricks-local.png" width="800px" align="center"> </a></p>
</section>
</section>
<section id="using-rstudio-connect-with-databricks" class="level2">
<h2 class="anchored" data-anchor-id="using-rstudio-connect-with-databricks">Using RStudio Connect with Databricks</h2>
<p>The server environment within Databricks clusters is not permissive enough to support RStudio Connect or the process sandboxing mechanisms that it uses to isolate published content.</p>
<p>Therefore, the only supported configuration is to install RStudio Connect outside of the Databricks cluster and connect to Databricks remotely.</p>
<p>Whether RStudio Workbench is installed outside of the Databricks cluster (Recommended Option) or within the Databricks cluster (Alternative Option), you can publish content to RStudio Connect as long as HTTP/HTTPS network traffic is allowed from RStudio Workbench to RStudio Connect.</p>
<p>There are two options for using RStudio Connect with Databricks:</p>
<ol type="1">
<li><a href="../examples/databricks-cluster-odbc">Performing SQL queries with ODBC using the Databricks Spark SQL Driver</a> (Recommended Option).</li>
<li>Adding calls in your R code to create and run Databricks jobs <a href="https://github.com/RafiKurlansik/bricksteR/">with bricksteR and the Databricks Jobs API</a> (Alternative Option)</li>
</ol>
<p><img src="../images/deployment/databricks/rstudio-connect-databricks.png" width="800px" align="center"></p>
</section>
<section id="using-rstudio-package-manager-with-databricks" class="level2">
<h2 class="anchored" data-anchor-id="using-rstudio-package-manager-with-databricks">Using RStudio Package Manager with Databricks</h2>
<p>Whether RStudio Workbench is installed outside of the Databricks cluster (Recommended Option) or within the Databricks cluster (Alternative Option), you can install packages from repositories in RStudio Package Manager as long as HTTP/HTTPS network traffic is allowed from RStudio Workbench to RStudio Package Manager.</p>
<!-- -->
</section>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
</div> <!-- /container fluid -->


</body></html>