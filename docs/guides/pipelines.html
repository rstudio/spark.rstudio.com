<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>sparklyr - Spark ML Pipelines</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
<script src="../site_libs/quarto-nav/quarto-nav.js"></script><script src="../site_libs/quarto-nav/headroom.min.js"></script><script src="../site_libs/clipboard/clipboard.min.js"></script><meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script><script src="../site_libs/quarto-search/fuse.min.js"></script><script src="../site_libs/quarto-search/quarto-search.js"></script><link href="../guides/h2o.html" rel="next">
<link href="../guides/mlib.html" rel="prev">
<link href="../images/favicon/apple-touch-icon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script><script src="../site_libs/quarto-html/popper.min.js"></script><script src="../site_libs/quarto-html/tippy.umd.min.js"></script><script src="../site_libs/quarto-html/anchor.min.js"></script><link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link class="quarto-color-scheme" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script><link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link class="quarto-color-scheme" href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/bootstrap/bootstrap-dark.min.css">
<script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script><!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]--><link rel="stylesheet" href="../styles.css">
</head>
<body class="floating">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <img src="../images/favicon/apple-touch-icon.png" alt=""><span class="navbar-title">sparklyr</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../get-started/index.html">Get Started</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../guides/index.html" aria-current="page">Guides</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../deployment/index.html">Deployment</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../packages/sparklyr/latest/news.html">News</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../packages/sparklyr/latest/reference/index.html">Reference</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../packages/index.html">Packages</a>
  </li>  
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Spark ML Pipelines</h1>
      <button type="button" class="quarto-btn-toggle btn">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="sidebar-tools-main">
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/index.html" class="sidebar-item-text ">Overview</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-interacting-with-spark" aria-expanded="true">Interacting with Spark</a>
      <a class="sidebar-item-toggle text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-interacting-with-spark" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-interacting-with-spark" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/dplyr.html" class="sidebar-item-text ">Using <code>dplyr</code></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/caching.html" class="sidebar-item-text ">Managing Spark cache</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/connections.html" class="sidebar-item-text ">Spark connection options</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/aws-s3.html" class="sidebar-item-text ">Access S3 buckets</a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-machine-learning" aria-expanded="true">Machine Learning</a>
      <a class="sidebar-item-toggle text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-machine-learning" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-machine-learning" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/mlib.html" class="sidebar-item-text ">Spark ML Overview</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/pipelines.html" class="sidebar-item-text active">ML Pipelines</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/h2o.html" class="sidebar-item-text ">H2O models</a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-non-rectangular-data" aria-expanded="true">Non-rectangular Data</a>
      <a class="sidebar-item-toggle text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-non-rectangular-data" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-non-rectangular-data" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/streaming.html" class="sidebar-item-text ">Streaming Data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/textmining.html" class="sidebar-item-text ">Text Data</a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-advanced" aria-expanded="true">Advanced</a>
      <a class="sidebar-item-toggle text-start  " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-advanced" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-advanced" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/distributed-r.html" class="sidebar-item-text ">Run R code inside Spark</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/extensions.html" class="sidebar-item-text ">Create <code>sparklyr</code> extensions</a>
  </div>
</li>
    </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../guides/troubleshooting.html" class="sidebar-item-text ">Troubleshooting</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc"><h2 id="toc-title">On this page</h2>
<ul>
<li>
<a href="#introduction-to-ml-pipelines" class="nav-link active" data-scroll-target="#introduction-to-ml-pipelines">Introduction to ML Pipelines</a>
<ul class="collapse">
<li><a href="#taking-advantage-of-pipelines-and-pipelinemodels" class="nav-link" data-scroll-target="#taking-advantage-of-pipelines-and-pipelinemodels">Taking advantage of Pipelines and PipelineModels</a></li>
</ul>
</li>
<li>
<a href="#pipeline" class="nav-link" data-scroll-target="#pipeline">Pipeline</a>
<ul class="collapse">
<li><a href="#feature-transformers" class="nav-link" data-scroll-target="#feature-transformers">Feature Transformers</a></li>
<li><a href="#ft_dplyr_transformer" class="nav-link" data-scroll-target="#ft_dplyr_transformer">ft_dplyr_transformer</a></li>
<li><a href="#creating-the-pipeline" class="nav-link" data-scroll-target="#creating-the-pipeline">Creating the Pipeline</a></li>
</ul>
</li>
<li><a href="#pipelinemodel" class="nav-link" data-scroll-target="#pipelinemodel">PipelineModel</a></li>
<li><a href="#save-the-pipelines-to-disk" class="nav-link" data-scroll-target="#save-the-pipelines-to-disk">Save the pipelines to disk</a></li>
<li><a href="#use-an-existing-pipelinemodel" class="nav-link" data-scroll-target="#use-an-existing-pipelinemodel">Use an existing PipelineModel</a></li>
<li><a href="#re-fit-an-existing-pipeline" class="nav-link" data-scroll-target="#re-fit-an-existing-pipeline">Re-fit an existing Pipeline</a></li>
</ul></nav>
</div>
<!-- main -->
<main class="content"><header id="title-block-header"><h1 class="title d-none d-lg-block display-7">Spark ML Pipelines</h1>
</header><p>Spark’s <strong>ML Pipelines</strong> provide a way to easily combine multiple transformations and algorithms into a single workflow, or pipeline.</p>
<p>For R users, the insights gathered during the interactive sessions with Spark can now be converted to a formal pipeline. This makes the hand-off from Data Scientists to Big Data Engineers a lot easier, this is because there should not be additional changes needed to be made by the later group.</p>
<p>The final list of selected variables, data manipulation, feature transformations and modeling can be easily re-written into a <code><a href="//reference/ml_pipeline.html">ml_pipeline()</a></code> object, saved, and ultimately placed into a Production environment. The <code>sparklyr</code> output of a saved Spark ML Pipeline object is in Scala code, which means that the code can be added to the scheduled Spark ML jobs, and without any dependencies in R.</p>
<section id="introduction-to-ml-pipelines" class="level2"><h2 class="anchored" data-anchor-id="introduction-to-ml-pipelines">Introduction to ML Pipelines</h2>
<p>The official Apache Spark site contains a more complete overview of <a href="http://spark.apache.org/docs/latest/ml-pipeline.html">ML Pipelines</a>. This article will focus in introducing the basic concepts and steps to work with ML Pipelines via <code>sparklyr</code>.</p>
<p>There are two important stages in building an ML Pipeline. The first one is creating a <strong>Pipeline</strong>. A good way to look at it, or call it, is as an <strong>“empty” pipeline</strong>. This step just builds the steps that the data will go through. This is the somewhat equivalent of doing this in R:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">r_pipeline</span> <span class="op">&lt;-</span>  <span class="va">.</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="va">cyl</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">+</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span>
<span class="va">r_pipeline</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>Functional sequence with the following components:

 1. mutate(., cyl = paste0("c", cyl))
 2. lm(am ~ cyl + mpg, data = .)

Use 'functions' to extract the individual functions. </code></pre>
</div>
</div>
<p>The <code>r_pipeline</code> object has all the steps needed to transform and fit the model, but it has not yet transformed any data. The second step, is to pass data through the pipeline, which in turn will output a fitted model. That is called a <strong>PipelineModel</strong>. The <strong>PipelineModel</strong> can then be used to produce predictions.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">r_model</span> <span class="op">&lt;-</span> <span class="fu">r_pipeline</span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>
<span class="va">r_model</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>
Call:
lm(formula = am ~ cyl + mpg, data = .)

Coefficients:
(Intercept)        cylc6        cylc8          mpg  
   -0.54388      0.03124     -0.03313      0.04767  </code></pre>
</div>
</div>
<section id="taking-advantage-of-pipelines-and-pipelinemodels" class="level3"><h3 class="anchored" data-anchor-id="taking-advantage-of-pipelines-and-pipelinemodels">Taking advantage of Pipelines and PipelineModels</h3>
<p>The two stage ML Pipeline approach produces two final data products:</p>
<ul>
<li><p>A <strong>PipelineModel</strong> that can be added to the daily Spark jobs which will produce new predictions for the incoming data, and again, with no R dependencies.</p></li>
<li><p>A <strong>Pipeline</strong> that can be <strong>easily re-fitted</strong> on a regular interval, say every month. All that is needed is to pass a new sample to obtain the new coefficients.</p></li>
</ul></section></section><section id="pipeline" class="level2"><h2 class="anchored" data-anchor-id="pipeline">Pipeline</h2>
<p>An additional goal of this article is that the reader can follow along, so the data, transformations and Spark connection in this example will be kept as easy to reproduce as possible.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://spark.rstudio.com/">sparklyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/spark-connections.html">spark_connect</a></span><span class="op">(</span>master <span class="op">=</span> <span class="st">"local"</span><span class="op">)</span>

<span class="va">spark_flights</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/copy_to.html">copy_to</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">flights</span><span class="op">)</span></code></pre></div>
</div>
<section id="feature-transformers" class="level3"><h3 class="anchored" data-anchor-id="feature-transformers">Feature Transformers</h3>
<p>Pipelines make heavy use of <a href="http://spark.rstudio.com/reference/#section-spark-feature-transformers">Feature Transformers</a>. If new to Spark, and <code>sparklyr</code>, it would be good to review what these transformers do. These functions use the Spark API directly to transform the data, and may be faster at making the data manipulations that a <code>dplyr</code> (SQL) transformation.</p>
<p>In <code>sparklyr</code> the <code>ft</code> functions are essentially are wrappers to original <a href="http://spark.apache.org/docs/latest/ml-features.html">Spark feature transformer</a>.</p>
</section><section id="ft_dplyr_transformer" class="level3"><h3 class="anchored" data-anchor-id="ft_dplyr_transformer">ft_dplyr_transformer</h3>
<p>This example will start with <code>dplyr</code> transformations, which are ultimately SQL transformations, loaded into the <code>df</code> variable.</p>
<p>In <code>sparklyr</code>, there is one feature transformer that is not available in Spark, <code><a href="//reference/sql-transformer.html">ft_dplyr_transformer()</a></code>. The goal of this function is to convert the <code>dplyr</code> code to a SQL Feature Transformer that can then be used in a Pipeline.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">spark_flights</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dep_delay</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/mutate.html">mutate</a></span><span class="op">(</span>
    month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="va">month</span><span class="op">)</span>,
    day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"d"</span>, <span class="va">day</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/select.html">select</a></span><span class="op">(</span><span class="va">dep_delay</span>, <span class="va">sched_dep_time</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">distance</span><span class="op">)</span> </code></pre></div>
</div>
<p>This is the resulting pipeline stage produced from the <code>dplyr</code> code:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="/packages/sparklyr/latest/reference/sql-transformer.html">ft_dplyr_transformer</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">df</span><span class="op">)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>SQLTransformer (Transformer)
&lt;dplyr_transformer__8ba1e82c_e9b0_4914_b571_2a71c8e1f4ea&gt; 
 (Parameters -- Column Names)</code></pre>
</div>
</div>
<p>Use the <code><a href="//reference/ml-params.html">ml_param()</a></code> function to extract the “statement” attribute. That attribute contains the finalized SQL statement. Notice that the <code>flights</code> table name has been replace with <code>__THIS__</code>. This allows the pipeline to accept different table names as its source, making the pipeline very modular.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="/packages/sparklyr/latest/reference/sql-transformer.html">ft_dplyr_transformer</a></span><span class="op">(</span><span class="va">sc</span>, <span class="va">df</span><span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/ml-params.html">ml_param</a></span><span class="op">(</span><span class="st">"statement"</span><span class="op">)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>[1] "SELECT `dep_delay`, `sched_dep_time`, CONCAT(\"m\", `month`) AS `month`, CONCAT(\"d\", `day`) AS `day`, `distance`\nFROM `__THIS__`\nWHERE (NOT(((`dep_delay`) IS NULL)))"</code></pre>
</div>
</div>
</section><section id="creating-the-pipeline" class="level3"><h3 class="anchored" data-anchor-id="creating-the-pipeline">Creating the Pipeline</h3>
<p>The following step will create a 5 stage pipeline:</p>
<ol type="1">
<li>SQL transformer - Resulting from the <code><a href="//reference/sql-transformer.html">ft_dplyr_transformer()</a></code> transformation</li>
<li>Binarizer - To determine if the flight should be considered delay. The eventual outcome variable.</li>
<li>Bucketizer - To split the day into specific hour buckets</li>
<li>R Formula - To define the model’s formula</li>
<li>Logistic Model</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">flights_pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/ml_pipeline.html">ml_pipeline</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/sql-transformer.html">ft_dplyr_transformer</a></span><span class="op">(</span>
    tbl <span class="op">=</span> <span class="va">df</span>
    <span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/ft_binarizer.html">ft_binarizer</a></span><span class="op">(</span>
    input_col <span class="op">=</span> <span class="st">"dep_delay"</span>,
    output_col <span class="op">=</span> <span class="st">"delayed"</span>,
    threshold <span class="op">=</span> <span class="fl">15</span>
  <span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/ft_bucketizer.html">ft_bucketizer</a></span><span class="op">(</span>
    input_col <span class="op">=</span> <span class="st">"sched_dep_time"</span>,
    output_col <span class="op">=</span> <span class="st">"hours"</span>,
    splits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">800</span>, <span class="fl">1200</span>, <span class="fl">1600</span>, <span class="fl">2000</span>, <span class="fl">2400</span><span class="op">)</span>
  <span class="op">)</span>  <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/ft_r_formula.html">ft_r_formula</a></span><span class="op">(</span><span class="va">delayed</span> <span class="op">~</span> <span class="va">month</span> <span class="op">+</span> <span class="va">day</span> <span class="op">+</span> <span class="va">hours</span> <span class="op">+</span> <span class="va">distance</span><span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="/packages/sparklyr/latest/reference/ml_logistic_regression.html">ml_logistic_regression</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<p>Another nice feature for ML Pipelines in <code>sparklyr</code>, is the print-out. It makes it really easy to how each stage is setup:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">flights_pipeline</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>Pipeline (Estimator) with 5 stages
&lt;pipeline__e4745ba2_5bf8_4555_88d9_4aa66aa7b6ba&gt; 
  Stages 
  |--1 SQLTransformer (Transformer)
  |    &lt;dplyr_transformer__e0e59acc_d897_4a93_9760_474ebc786add&gt; 
  |     (Parameters -- Column Names)
  |--2 Binarizer (Transformer)
  |    &lt;binarizer__5b3946fe_1209_4d5d_805c_ee7c79bea1f2&gt; 
  |     (Parameters -- Column Names)
  |      input_col: dep_delay
  |      output_col: delayed
  |--3 Bucketizer (Transformer)
  |    &lt;bucketizer__84db4fe8_4994_4ad3_9e04_a6bbb70e5cec&gt; 
  |     (Parameters -- Column Names)
  |      input_col: sched_dep_time
  |      output_col: hours
  |--4 RFormula (Estimator)
  |    &lt;r_formula__b6e8b330_5824_4719_9417_d14bd05de34f&gt; 
  |     (Parameters -- Column Names)
  |      features_col: features
  |      label_col: label
  |     (Parameters)
  |      force_index_label: FALSE
  |      formula: delayed ~ month + day + hours + distance
  |      handle_invalid: error
  |      stringIndexerOrderType: frequencyDesc
  |--5 LogisticRegression (Estimator)
  |    &lt;logistic_regression__3991e32e_fa8c_46f8_b337_1ea749ffb337&gt; 
  |     (Parameters -- Column Names)
  |      features_col: features
  |      label_col: label
  |      prediction_col: prediction
  |      probability_col: probability
  |      raw_prediction_col: rawPrediction
  |     (Parameters)
  |      aggregation_depth: 2
  |      elastic_net_param: 0
  |      family: auto
  |      fit_intercept: TRUE
  |      max_iter: 100
  |      maxBlockSizeInMB: 0
  |      reg_param: 0
  |      standardization: TRUE
  |      threshold: 0.5
  |      tol: 1e-06</code></pre>
</div>
</div>
<p>Notice that there are no <em>coefficients</em> defined yet. That’s because no data has been actually processed. Even though <code>df</code> uses <code>spark_flights()</code>, recall that the final SQL transformer makes that name, so there’s no data to process yet.</p>
</section></section><section id="pipelinemodel" class="level2"><h2 class="anchored" data-anchor-id="pipelinemodel">PipelineModel</h2>
<p>A quick partition of the data is created for this exercise.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">partitioned_flights</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/sdf_random_split.html">sdf_random_split</a></span><span class="op">(</span>
  <span class="va">spark_flights</span>,
  training <span class="op">=</span> <span class="fl">0.01</span>,
  testing <span class="op">=</span> <span class="fl">0.01</span>,
  rest <span class="op">=</span> <span class="fl">0.98</span>
<span class="op">)</span></code></pre></div>
</div>
<p>The <code><a href="//reference/ml-transform-methods.html">ml_fit()</a></code> function produces the PipelineModel. The <code>training</code> partition of the <code>partitioned_flights</code> data is used to train the model:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">fitted_pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/ml-transform-methods.html">ml_fit</a></span><span class="op">(</span>
  <span class="va">flights_pipeline</span>,
  <span class="va">partitioned_flights</span><span class="op">$</span><span class="va">training</span>
<span class="op">)</span>
<span class="va">fitted_pipeline</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>PipelineModel (Transformer) with 5 stages
&lt;pipeline__e4745ba2_5bf8_4555_88d9_4aa66aa7b6ba&gt; 
  Stages 
  |--1 SQLTransformer (Transformer)
  |    &lt;dplyr_transformer__e0e59acc_d897_4a93_9760_474ebc786add&gt; 
  |     (Parameters -- Column Names)
  |--2 Binarizer (Transformer)
  |    &lt;binarizer__5b3946fe_1209_4d5d_805c_ee7c79bea1f2&gt; 
  |     (Parameters -- Column Names)
  |      input_col: dep_delay
  |      output_col: delayed
  |--3 Bucketizer (Transformer)
  |    &lt;bucketizer__84db4fe8_4994_4ad3_9e04_a6bbb70e5cec&gt; 
  |     (Parameters -- Column Names)
  |      input_col: sched_dep_time
  |      output_col: hours
  |--4 RFormulaModel (Transformer)
  |    &lt;r_formula__b6e8b330_5824_4719_9417_d14bd05de34f&gt; 
  |     (Parameters -- Column Names)
  |      features_col: features
  |      label_col: label
  |     (Transformer Info)
  |      formula:  chr "delayed ~ month + day + hours + distance" 
  |--5 LogisticRegressionModel (Transformer)
  |    &lt;logistic_regression__3991e32e_fa8c_46f8_b337_1ea749ffb337&gt; 
  |     (Parameters -- Column Names)
  |      features_col: features
  |      label_col: label
  |      prediction_col: prediction
  |      probability_col: probability
  |      raw_prediction_col: rawPrediction
  |     (Transformer Info)
  |      coefficient_matrix:  num [1, 1:43] 0.47246 0.8963 0.23965 0.00185 -0.03954 ... 
  |      coefficients:  num [1:43] 0.47246 0.8963 0.23965 0.00185 -0.03954 ... 
  |      intercept:  num -2.8 
  |      intercept_vector:  num -2.8 
  |      num_classes:  int 2 
  |      num_features:  int 43 
  |      threshold:  num 0.5 
  |      thresholds:  num [1:2] 0.5 0.5 </code></pre>
</div>
</div>
<p>Notice that the print-out for the fitted pipeline now displays the model’s coefficients.</p>
<p>The <code><a href="//reference/ml-transform-methods.html">ml_transform()</a></code> function can be used to run predictions, in other words it is used instead of <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> or <code><a href="//reference/sdf-transform-methods.html">sdf_predict()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/ml-transform-methods.html">ml_transform</a></span><span class="op">(</span>
  <span class="va">fitted_pipeline</span>,
  <span class="va">partitioned_flights</span><span class="op">$</span><span class="va">testing</span>
<span class="op">)</span>

<span class="va">predictions</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">delayed</span>, <span class="va">prediction</span><span class="op">)</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">tally</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code># Source: spark&lt;?&gt; [?? x 3]
# Groups: delayed
  delayed prediction     n
    &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
1       0          1    35
2       0          0  2569
3       1          0   650
4       1          1    56</code></pre>
</div>
</div>
</section><section id="save-the-pipelines-to-disk" class="level2"><h2 class="anchored" data-anchor-id="save-the-pipelines-to-disk">Save the pipelines to disk</h2>
<p>The <code><a href="//reference/ml-persistence.html">ml_save()</a></code> command can be used to save the Pipeline and PipelineModel to disk. The resulting output is a folder with the selected name, which contains all of the necessary Scala scripts:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="/packages/sparklyr/latest/reference/ml-persistence.html">ml_save</a></span><span class="op">(</span>
  <span class="va">flights_pipeline</span>,
  <span class="st">"flights_pipeline"</span>,
  overwrite <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="cell-output-stderr">
<pre><code>Model successfully saved.</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="/packages/sparklyr/latest/reference/ml-persistence.html">ml_save</a></span><span class="op">(</span>
  <span class="va">fitted_pipeline</span>,
  <span class="st">"flights_model"</span>,
  overwrite <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="cell-output-stderr">
<pre><code>Model successfully saved.</code></pre>
</div>
</div>
</section><section id="use-an-existing-pipelinemodel" class="level2"><h2 class="anchored" data-anchor-id="use-an-existing-pipelinemodel">Use an existing PipelineModel</h2>
<p>The <code><a href="//reference/ml-persistence.html">ml_load()</a></code> command can be used to re-load Pipelines and PipelineModels. The saved ML Pipeline files can only be loaded into an open Spark session.</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">reloaded_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/ml-persistence.html">ml_load</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"flights_model"</span><span class="op">)</span></code></pre></div>
</div>
<p>A simple query can be used as the table that will be used to make the new predictions. This of course, does not have to done in R, at this time the “flights_model” can be loaded into an independent Spark session outside of R.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">new_df</span> <span class="op">&lt;-</span> <span class="va">spark_flights</span> <span class="op"><a href="/packages/sparklyr/latest/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="/packages/sparklyr/latest/reference/filter.html">filter</a></span><span class="op">(</span>
    <span class="va">month</span> <span class="op">==</span> <span class="fl">7</span>,
    <span class="va">day</span> <span class="op">==</span> <span class="fl">5</span>
  <span class="op">)</span>

<span class="fu"><a href="/packages/sparklyr/latest/reference/ml-transform-methods.html">ml_transform</a></span><span class="op">(</span><span class="va">reloaded_model</span>, <span class="va">new_df</span><span class="op">)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code># Source: spark&lt;?&gt; [?? x 12]
   dep_delay sched_dep_time month day   distance delayed hours features   label
       &lt;dbl&gt;          &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;     &lt;dbl&gt;
 1        39           2359 m7    d5        1617       1     4 &lt;dbl [43]&gt;     1
 2       141           2245 m7    d5        2475       1     4 &lt;dbl [43]&gt;     1
 3         0            500 m7    d5         529       0     0 &lt;dbl [43]&gt;     0
 4        -5            536 m7    d5        1400       0     0 &lt;dbl [43]&gt;     0
 5        -2            540 m7    d5        1089       0     0 &lt;dbl [43]&gt;     0
 6        -7            545 m7    d5        1416       0     0 &lt;dbl [43]&gt;     0
 7        -3            545 m7    d5        1576       0     0 &lt;dbl [43]&gt;     0
 8        -7            600 m7    d5        1076       0     0 &lt;dbl [43]&gt;     0
 9        -7            600 m7    d5          96       0     0 &lt;dbl [43]&gt;     0
10        -6            600 m7    d5         937       0     0 &lt;dbl [43]&gt;     0
# … with more rows, and 3 more variables: rawPrediction &lt;list&gt;,
#   probability &lt;list&gt;, prediction &lt;dbl&gt;</code></pre>
</div>
</div>
</section><section id="re-fit-an-existing-pipeline" class="level2"><h2 class="anchored" data-anchor-id="re-fit-an-existing-pipeline">Re-fit an existing Pipeline</h2>
<p>First, reload the pipeline into an open Spark session:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">reloaded_pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="/packages/sparklyr/latest/reference/ml-persistence.html">ml_load</a></span><span class="op">(</span><span class="va">sc</span>, <span class="st">"flights_pipeline"</span><span class="op">)</span></code></pre></div>
</div>
<p>Use <code><a href="//reference/ml-transform-methods.html">ml_fit()</a></code> again to pass new data, in this case, <code><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_frac()</a></code> is used instead of <code><a href="//reference/sdf_random_split.html">sdf_partition()</a></code> to provide the new data. The idea being that the re-fitting would happen at a later date than when the model was initially fitted.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">new_model</span> <span class="op">&lt;-</span>  <span class="fu"><a href="/packages/sparklyr/latest/reference/ml-transform-methods.html">ml_fit</a></span><span class="op">(</span><span class="va">reloaded_pipeline</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_frac</a></span><span class="op">(</span><span class="va">spark_flights</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>

<span class="va">new_model</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>PipelineModel (Transformer) with 5 stages
&lt;pipeline__e4745ba2_5bf8_4555_88d9_4aa66aa7b6ba&gt; 
  Stages 
  |--1 SQLTransformer (Transformer)
  |    &lt;dplyr_transformer__e0e59acc_d897_4a93_9760_474ebc786add&gt; 
  |     (Parameters -- Column Names)
  |--2 Binarizer (Transformer)
  |    &lt;binarizer__5b3946fe_1209_4d5d_805c_ee7c79bea1f2&gt; 
  |     (Parameters -- Column Names)
  |      input_col: dep_delay
  |      output_col: delayed
  |--3 Bucketizer (Transformer)
  |    &lt;bucketizer__84db4fe8_4994_4ad3_9e04_a6bbb70e5cec&gt; 
  |     (Parameters -- Column Names)
  |      input_col: sched_dep_time
  |      output_col: hours
  |--4 RFormulaModel (Transformer)
  |    &lt;r_formula__b6e8b330_5824_4719_9417_d14bd05de34f&gt; 
  |     (Parameters -- Column Names)
  |      features_col: features
  |      label_col: label
  |     (Transformer Info)
  |      formula:  chr "delayed ~ month + day + hours + distance" 
  |--5 LogisticRegressionModel (Transformer)
  |    &lt;logistic_regression__3991e32e_fa8c_46f8_b337_1ea749ffb337&gt; 
  |     (Parameters -- Column Names)
  |      features_col: features
  |      label_col: label
  |      prediction_col: prediction
  |      probability_col: probability
  |      raw_prediction_col: rawPrediction
  |     (Transformer Info)
  |      coefficient_matrix:  num [1, 1:43] 0.111 -0.798 -0.626 -0.355 -0.19 ... 
  |      coefficients:  num [1:43] 0.111 -0.798 -0.626 -0.355 -0.19 ... 
  |      intercept:  num -2.08 
  |      intercept_vector:  num -2.08 
  |      num_classes:  int 2 
  |      num_features:  int 43 
  |      threshold:  num 0.5 
  |      thresholds:  num [1:2] 0.5 0.5 </code></pre>
</div>
</div>
<p>The new model can be saved using <code><a href="//reference/ml-persistence.html">ml_save()</a></code>. A new name is used in this case, but the same name as the existing PipelineModel to replace it.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="/packages/sparklyr/latest/reference/ml-persistence.html">ml_save</a></span><span class="op">(</span><span class="va">new_model</span>, <span class="st">"new_flights_model"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="cell-output-stderr">
<pre><code>Model successfully saved.</code></pre>
</div>
</div>
<p>Finally, this example is complete by closing the Spark session.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="/packages/sparklyr/latest/reference/spark-connections.html">spark_disconnect</a></span><span class="op">(</span><span class="va">sc</span><span class="op">)</span></code></pre></div>
</div>


</section></main><!-- /main --><script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      return window.localStorage.getItem("quarto-color-scheme");
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = null;
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.id = "quarto-color-scheme-toggle";
    a.classList.add('top-right');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../guides/mlib.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Spark ML Overview</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../guides/h2o.html">
        <span class="nav-page-text">H2O models</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->


</body>
</html>
